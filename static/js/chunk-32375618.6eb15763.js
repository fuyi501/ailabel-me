(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-32375618"],{"219e":function(e,t,n){"use strict";var r=n("de3d");function i(){}var o={},a=["REJECTED"],s=["FULFILLED"],u=["PENDING"];function l(e){if("function"!==typeof e)throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,e!==i&&f(this,e)}function h(e,t,n){this.promise=e,"function"===typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"===typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function c(e,t,n){r((function(){var r;try{r=t(n)}catch(i){return o.reject(e,i)}r===e?o.reject(e,new TypeError("Cannot resolve promise with itself")):o.resolve(e,r)}))}function v(e){var t=e&&e.then;if(e&&("object"===typeof e||"function"===typeof e)&&"function"===typeof t)return function(){t.apply(e,arguments)}}function f(e,t){var n=!1;function r(t){n||(n=!0,o.reject(e,t))}function i(t){n||(n=!0,o.resolve(e,t))}function a(){t(i,r)}var s=d(a);"error"===s.status&&r(s.value)}function d(e,t){var n={};try{n.value=e(t),n.status="success"}catch(r){n.status="error",n.value=r}return n}function y(e){return e instanceof this?e:o.resolve(new this(i),e)}function p(e){var t=new this(i);return o.reject(t,e)}function m(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);var a=new Array(n),s=0,u=-1,l=new this(i);while(++u<n)h(e[u],u);return l;function h(e,i){function u(e){a[i]=e,++s!==n||r||(r=!0,o.resolve(l,a))}t.resolve(e).then(u,(function(e){r||(r=!0,o.reject(l,e))}))}}function g(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);var a=-1,s=new this(i);while(++a<n)u(e[a]);return s;function u(e){t.resolve(e).then((function(e){r||(r=!0,o.resolve(s,e))}),(function(e){r||(r=!0,o.reject(s,e))}))}}e.exports=l,l.prototype["finally"]=function(e){if("function"!==typeof e)return this;var t=this.constructor;return this.then(n,r);function n(n){function r(){return n}return t.resolve(e()).then(r)}function r(n){function r(){throw n}return t.resolve(e()).then(r)}},l.prototype["catch"]=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if("function"!==typeof e&&this.state===s||"function"!==typeof t&&this.state===a)return this;var n=new this.constructor(i);if(this.state!==u){var r=this.state===s?e:t;c(n,r,this.outcome)}else this.queue.push(new h(n,e,t));return n},h.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},h.prototype.otherCallFulfilled=function(e){c(this.promise,this.onFulfilled,e)},h.prototype.callRejected=function(e){o.reject(this.promise,e)},h.prototype.otherCallRejected=function(e){c(this.promise,this.onRejected,e)},o.resolve=function(e,t){var n=d(v,t);if("error"===n.status)return o.reject(e,n.value);var r=n.value;if(r)f(e,r);else{e.state=s,e.outcome=t;var i=-1,a=e.queue.length;while(++i<a)e.queue[i].callFulfilled(t)}return e},o.reject=function(e,t){e.state=a,e.outcome=t;var n=-1,r=e.queue.length;while(++n<r)e.queue[n].callRejected(t);return e},l.resolve=y,l.reject=p,l.all=m,l.race=g},2909:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n("6b75");function i(e){if(Array.isArray(e))return Object(r["a"])(e)}n("a4d3"),n("e01a"),n("d3b7"),n("d28b"),n("3ca3"),n("ddb0"),n("a630");function o(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}var a=n("06c5");function s(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(e){return i(e)||o(e)||Object(a["a"])(e)||s()}},3835:function(e,t,n){"use strict";function r(e){if(Array.isArray(e))return e}n.d(t,"a",(function(){return s}));n("a4d3"),n("e01a"),n("d3b7"),n("d28b"),n("3ca3"),n("ddb0");function i(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done);a=!0)if(o.push(r.value),t&&o.length===t)break}catch(u){s=!0,i=u}finally{try{a||null==n["return"]||n["return"]()}finally{if(s)throw i}}return o}}var o=n("06c5");function a(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(e,t){return r(e)||i(e,t)||Object(o["a"])(e,t)||a()}},"7db0":function(e,t,n){"use strict";var r=n("23e7"),i=n("b727").find,o=n("44d2"),a="find",s=!0;a in[]&&Array(1)[a]((function(){s=!1})),r({target:"Array",proto:!0,forced:s},{find:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),o(a)},"7e66":function(e,t,n){(function(t){(function(t,n){e.exports=n()})(0,(function(){"use strict";function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function n(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?e(Object(r),!0).forEach((function(e){a(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}function l(e,t){return l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},l(e,t)}function h(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function v(e,t){return!t||"object"!==typeof t&&"function"!==typeof t?c(e):t}function f(e){var t=h();return function(){var n,r=u(e);if(t){var i=u(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return v(this,n)}}function d(e,t){while(!Object.prototype.hasOwnProperty.call(e,t))if(e=u(e),null===e)break;return e}function y(e,t,n){return y="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=d(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}},y(e,t,n||e)}function p(e,t){return m(e)||g(e,t)||b(e,t)||x()}function m(e){if(Array.isArray(e))return e}function g(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done);a=!0)if(o.push(r.value),t&&o.length===t)break}catch(u){s=!0,i=u}finally{try{a||null==n["return"]||n["return"]()}finally{if(s)throw i}}return o}}function b(e,t){if(e){if("string"===typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(e,t):void 0}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function x(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var k,S="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof t?t:"undefined"!==typeof self?self:{},P={exports:{}},D="object"===typeof Reflect?Reflect:null,M=D&&"function"===typeof D.apply?D.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};function A(e){console&&console.warn&&console.warn(e)}k=D&&"function"===typeof D.ownKeys?D.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var C=Number.isNaN||function(e){return e!==e};function O(){O.init.call(this)}P.exports=O,P.exports.once=G,O.EventEmitter=O,O.prototype._events=void 0,O.prototype._eventsCount=0,O.prototype._maxListeners=void 0;var T=10;function j(e){if("function"!==typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function I(e){return void 0===e._maxListeners?O.defaultMaxListeners:e._maxListeners}function L(e,t,n,r){var i,o,a;if(j(n),o=e._events,void 0===o?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]),void 0===a)a=o[t]=n,++e._eventsCount;else if("function"===typeof a?a=o[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),i=I(e),i>0&&a.length>i&&!a.warned){a.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=e,s.type=t,s.count=a.length,A(s)}return e}function F(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function E(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=F.bind(r);return i.listener=n,r.wrapFn=i,i}function _(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"===typeof i?n?[i.listener||i]:[i]:n?W(i):z(i,i.length)}function R(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"===typeof n)return 1;if(void 0!==n)return n.length}return 0}function z(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function U(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function W(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function G(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"===typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}K(e,t,o,{once:!0}),"error"!==t&&B(e,i,{once:!0})}))}function B(e,t,n){"function"===typeof e.on&&K(e,"error",t,n)}function K(e,t,n,r){if("function"===typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!==typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){r.once&&e.removeEventListener(t,i),n(o)}))}}Object.defineProperty(O,"defaultMaxListeners",{enumerable:!0,get:function(){return T},set:function(e){if("number"!==typeof e||e<0||C(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");T=e}}),O.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},O.prototype.setMaxListeners=function(e){if("number"!==typeof e||e<0||C(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},O.prototype.getMaxListeners=function(){return I(this)},O.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var s=i[e];if(void 0===s)return!1;if("function"===typeof s)M(s,this,t);else{var u=s.length,l=z(s,u);for(n=0;n<u;++n)M(l[n],this,t)}return!0},O.prototype.addListener=function(e,t){return L(this,e,t,!1)},O.prototype.on=O.prototype.addListener,O.prototype.prependListener=function(e,t){return L(this,e,t,!0)},O.prototype.once=function(e,t){return j(t),this.on(e,E(this,e,t)),this},O.prototype.prependOnceListener=function(e,t){return j(t),this.prependListener(e,E(this,e,t)),this},O.prototype.removeListener=function(e,t){var n,r,i,o,a;if(j(t),r=this._events,void 0===r)return this;if(n=r[e],void 0===n)return this;if(n===t||n.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!==typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():U(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},O.prototype.off=O.prototype.removeListener,O.prototype.removeAllListeners=function(e){var t,n,r;if(n=this._events,void 0===n)return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)i=o[r],"removeListener"!==i&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],"function"===typeof t)this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},O.prototype.listeners=function(e){return _(this,e,!0)},O.prototype.rawListeners=function(e){return _(this,e,!1)},O.listenerCount=function(e,t){return"function"===typeof e.listenerCount?e.listenerCount(t):R.call(e,t)},O.prototype.listenerCount=R,O.prototype.eventNames=function(){return this._eventsCount>0?k(this._events):[]};var N=P.exports,Y="undefined"!==typeof navigator&&navigator.userAgent.toLowerCase().indexOf("firefox")>0;
/*!
   * hotkeys-js v3.8.7
   * A simple micro-library for defining and dispatching keyboard shortcuts. It has no dependencies.
   * 
   * Copyright (c) 2021 kenny wong <wowohoo@qq.com>
   * http://jaywcjlove.github.io/hotkeys
   * 
   * Licensed under the MIT license.
   */function X(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on".concat(t),(function(){n(window.event)}))}function $(e,t){for(var n=t.slice(0,t.length-1),r=0;r<n.length;r++)n[r]=e[n[r].toLowerCase()];return n}function q(e){"string"!==typeof e&&(e=""),e=e.replace(/\s/g,"");for(var t=e.split(","),n=t.lastIndexOf("");n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}function Z(e,t){for(var n=e.length>=t.length?e:t,r=e.length>=t.length?t:e,i=!0,o=0;o<n.length;o++)-1===r.indexOf(n[o])&&(i=!1);return i}for(var V={backspace:8,tab:9,clear:12,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":Y?173:189,"=":Y?61:187,";":Y?59:186,"'":222,"[":219,"]":221,"\\":220},J={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,command:91},H={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},Q={16:!1,18:!1,17:!1,91:!1},ee={},te=1;te<20;te++)V["f".concat(te)]=111+te;var ne=[],re="all",ie=[],oe=function(e){return V[e.toLowerCase()]||J[e.toLowerCase()]||e.toUpperCase().charCodeAt(0)};function ae(e){re=e||"all"}function se(){return re||"all"}function ue(){return ne.slice(0)}function le(e){var t=e.target||e.srcElement,n=t.tagName,r=!0;return!t.isContentEditable&&("INPUT"!==n&&"TEXTAREA"!==n&&"SELECT"!==n||t.readOnly)||(r=!1),r}function he(e){return"string"===typeof e&&(e=oe(e)),-1!==ne.indexOf(e)}function ce(e,t){var n,r;for(var i in e||(e=se()),ee)if(Object.prototype.hasOwnProperty.call(ee,i))for(n=ee[i],r=0;r<n.length;)n[r].scope===e?n.splice(r,1):r++;se()===e&&ae(t||"all")}function ve(e){var t=e.keyCode||e.which||e.charCode,n=ne.indexOf(t);if(n>=0&&ne.splice(n,1),e.key&&"meta"===e.key.toLowerCase()&&ne.splice(0,ne.length),93!==t&&224!==t||(t=91),t in Q)for(var r in Q[t]=!1,J)J[r]===t&&(ge[r]=!1)}function fe(e){if(e){if(Array.isArray(e))e.forEach((function(e){e.key&&de(e)}));else if("object"===typeof e)e.key&&de(e);else if("string"===typeof e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n[0],o=n[1];"function"===typeof i&&(o=i,i=""),de({key:e,scope:i,method:o,splitKey:"+"})}}else Object.keys(ee).forEach((function(e){return delete ee[e]}))}var de=function(e){var t=e.key,n=e.scope,r=e.method,i=e.splitKey,o=void 0===i?"+":i,a=q(t);a.forEach((function(e){var t=e.split(o),i=t.length,a=t[i-1],s="*"===a?"*":oe(a);if(ee[s]){n||(n=se());var u=i>1?$(J,t):[];ee[s]=ee[s].map((function(e){var t=!r||e.method===r;return t&&e.scope===n&&Z(e.mods,u)?{}:e}))}}))};function ye(e,t,n){var r;if(t.scope===n||"all"===t.scope){for(var i in r=t.mods.length>0,Q)Object.prototype.hasOwnProperty.call(Q,i)&&(!Q[i]&&t.mods.indexOf(+i)>-1||Q[i]&&-1===t.mods.indexOf(+i))&&(r=!1);(0!==t.mods.length||Q[16]||Q[18]||Q[17]||Q[91])&&!r&&"*"!==t.shortcut||!1===t.method(e,t)&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0))}}function pe(e){var t=ee["*"],n=e.keyCode||e.which||e.charCode;if(ge.filter.call(this,e)){if(93!==n&&224!==n||(n=91),-1===ne.indexOf(n)&&229!==n&&ne.push(n),["ctrlKey","altKey","shiftKey","metaKey"].forEach((function(t){var n=H[t];e[t]&&-1===ne.indexOf(n)?ne.push(n):!e[t]&&ne.indexOf(n)>-1?ne.splice(ne.indexOf(n),1):"metaKey"===t&&e[t]&&3===ne.length&&(e.ctrlKey||e.shiftKey||e.altKey||(ne=ne.slice(ne.indexOf(n))))})),n in Q){for(var r in Q[n]=!0,J)J[r]===n&&(ge[r]=!0);if(!t)return}for(var i in Q)Object.prototype.hasOwnProperty.call(Q,i)&&(Q[i]=e[H[i]]);e.getModifierState&&(!e.altKey||e.ctrlKey)&&e.getModifierState("AltGraph")&&(-1===ne.indexOf(17)&&ne.push(17),-1===ne.indexOf(18)&&ne.push(18),Q[17]=!0,Q[18]=!0);var o=se();if(t)for(var a=0;a<t.length;a++)t[a].scope===o&&("keydown"===e.type&&t[a].keydown||"keyup"===e.type&&t[a].keyup)&&ye(e,t[a],o);if(n in ee)for(var s=0;s<ee[n].length;s++)if(("keydown"===e.type&&ee[n][s].keydown||"keyup"===e.type&&ee[n][s].keyup)&&ee[n][s].key){for(var u=ee[n][s],l=u.splitKey,h=u.key.split(l),c=[],v=0;v<h.length;v++)c.push(oe(h[v]));c.sort().join("")===ne.sort().join("")&&ye(e,u,o)}}}function me(e){return ie.indexOf(e)>-1}function ge(e,t,n){ne=[];var r=q(e),i=[],o="all",a=document,s=0,u=!1,l=!0,h="+";for(void 0===n&&"function"===typeof t&&(n=t),"[object Object]"===Object.prototype.toString.call(t)&&(t.scope&&(o=t.scope),t.element&&(a=t.element),t.keyup&&(u=t.keyup),void 0!==t.keydown&&(l=t.keydown),"string"===typeof t.splitKey&&(h=t.splitKey)),"string"===typeof t&&(o=t);s<r.length;s++)e=r[s].split(h),i=[],e.length>1&&(i=$(J,e)),e=e[e.length-1],e="*"===e?"*":oe(e),e in ee||(ee[e]=[]),ee[e].push({keyup:u,keydown:l,scope:o,mods:i,shortcut:r[s],method:n,key:r[s],splitKey:h});"undefined"!==typeof a&&!me(a)&&window&&(ie.push(a),X(a,"keydown",(function(e){pe(e)})),X(window,"focus",(function(){ne=[]})),X(a,"keyup",(function(e){pe(e),ve(e)})))}var be={setScope:ae,getScope:se,deleteScope:ce,getPressedKeyCodes:ue,isPressed:he,filter:le,unbind:fe};for(var we in be)Object.prototype.hasOwnProperty.call(be,we)&&(ge[we]=be[we]);if("undefined"!==typeof window){var xe=window.hotkeys;ge.noConflict=function(e){return e&&window.hotkeys===ge&&(window.hotkeys=xe),ge},window.hotkeys=ge}var ke="object"==typeof S&&S&&S.Object===Object&&S,Se=ke,Pe=Se,De="object"==typeof self&&self&&self.Object===Object&&self,Me=Pe||De||Function("return this")(),Ae=Me,Ce=Ae,Oe=Ce.Symbol,Te=Oe,je=Te,Ie=Object.prototype,Le=Ie.hasOwnProperty,Fe=Ie.toString,Ee=je?je.toStringTag:void 0;function _e(e){var t=Le.call(e,Ee),n=e[Ee];try{e[Ee]=void 0;var r=!0}catch(o){}var i=Fe.call(e);return r&&(t?e[Ee]=n:delete e[Ee]),i}var Re=_e,ze=Object.prototype,Ue=ze.toString;function We(e){return Ue.call(e)}var Ge=We,Be=Te,Ke=Re,Ne=Ge,Ye="[object Null]",Xe="[object Undefined]",$e=Be?Be.toStringTag:void 0;function qe(e){return null==e?void 0===e?Xe:Ye:$e&&$e in Object(e)?Ke(e):Ne(e)}var Ze=qe;function Ve(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var Je=Ve,He=Ze,Qe=Je,et="[object AsyncFunction]",tt="[object Function]",nt="[object GeneratorFunction]",rt="[object Proxy]";function it(e){if(!Qe(e))return!1;var t=He(e);return t==tt||t==nt||t==et||t==rt}var ot=it,at=Ae,st=at["__core-js_shared__"],ut=st,lt=ut,ht=function(){var e=/[^.]+$/.exec(lt&&lt.keys&&lt.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function ct(e){return!!ht&&ht in e}var vt=ct,ft=Function.prototype,dt=ft.toString;function yt(e){if(null!=e){try{return dt.call(e)}catch(t){}try{return e+""}catch(t){}}return""}var pt=yt,mt=ot,gt=vt,bt=Je,wt=pt,xt=/[\\^$.*+?()[\]{}|]/g,kt=/^\[object .+?Constructor\]$/,St=Function.prototype,Pt=Object.prototype,Dt=St.toString,Mt=Pt.hasOwnProperty,At=RegExp("^"+Dt.call(Mt).replace(xt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Ct(e){if(!bt(e)||gt(e))return!1;var t=mt(e)?At:kt;return t.test(wt(e))}var Ot=Ct;function Tt(e,t){return null==e?void 0:e[t]}var jt=Tt,It=Ot,Lt=jt;function Ft(e,t){var n=Lt(e,t);return It(n)?n:void 0}var Et=Ft,_t=Et,Rt=function(){try{var e=_t(Object,"defineProperty");return e({},"",{}),e}catch(t){}}(),zt=Rt,Ut=zt;function Wt(e,t,n){"__proto__"==t&&Ut?Ut(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}var Gt=Wt;function Bt(e,t){return e===t||e!==e&&t!==t}var Kt=Bt,Nt=Gt,Yt=Kt,Xt=Object.prototype,$t=Xt.hasOwnProperty;function qt(e,t,n){var r=e[t];$t.call(e,t)&&Yt(r,n)&&(void 0!==n||t in e)||Nt(e,t,n)}var Zt=qt,Vt=Zt,Jt=Gt;function Ht(e,t,n,r){var i=!n;n||(n={});var o=-1,a=t.length;while(++o<a){var s=t[o],u=r?r(n[s],e[s],s,n,e):void 0;void 0===u&&(u=e[s]),i?Jt(n,s,u):Vt(n,s,u)}return n}var Qt=Ht;function en(e){return e}var tn=en;function nn(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}var rn=nn,on=rn,an=Math.max;function sn(e,t,n){return t=an(void 0===t?e.length-1:t,0),function(){var r=arguments,i=-1,o=an(r.length-t,0),a=Array(o);while(++i<o)a[i]=r[t+i];i=-1;var s=Array(t+1);while(++i<t)s[i]=r[i];return s[t]=n(a),on(e,this,s)}}var un=sn;function ln(e){return function(){return e}}var hn=ln,cn=hn,vn=zt,fn=tn,dn=vn?function(e,t){return vn(e,"toString",{configurable:!0,enumerable:!1,value:cn(t),writable:!0})}:fn,yn=dn,pn=800,mn=16,gn=Date.now;function bn(e){var t=0,n=0;return function(){var r=gn(),i=mn-(r-n);if(n=r,i>0){if(++t>=pn)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var wn=bn,xn=yn,kn=wn,Sn=kn(xn),Pn=Sn,Dn=tn,Mn=un,An=Pn;function Cn(e,t){return An(Mn(e,t,Dn),e+"")}var On=Cn,Tn=9007199254740991;function jn(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=Tn}var In=jn,Ln=ot,Fn=In;function En(e){return null!=e&&Fn(e.length)&&!Ln(e)}var _n=En,Rn=9007199254740991,zn=/^(?:0|[1-9]\d*)$/;function Un(e,t){var n=typeof e;return t=null==t?Rn:t,!!t&&("number"==n||"symbol"!=n&&zn.test(e))&&e>-1&&e%1==0&&e<t}var Wn=Un,Gn=Kt,Bn=_n,Kn=Wn,Nn=Je;function Yn(e,t,n){if(!Nn(n))return!1;var r=typeof t;return!!("number"==r?Bn(n)&&Kn(t,n.length):"string"==r&&t in n)&&Gn(n[t],e)}var Xn=Yn,$n=On,qn=Xn;function Zn(e){return $n((function(t,n){var r=-1,i=n.length,o=i>1?n[i-1]:void 0,a=i>2?n[2]:void 0;o=e.length>3&&"function"==typeof o?(i--,o):void 0,a&&qn(n[0],n[1],a)&&(o=i<3?void 0:o,i=1),t=Object(t);while(++r<i){var s=n[r];s&&e(t,s,r,o)}return t}))}var Vn=Zn,Jn=Object.prototype;function Hn(e){var t=e&&e.constructor,n="function"==typeof t&&t.prototype||Jn;return e===n}var Qn=Hn;function er(e,t){var n=-1,r=Array(e);while(++n<e)r[n]=t(n);return r}var tr=er;function nr(e){return null!=e&&"object"==typeof e}var rr=nr,ir=Ze,or=rr,ar="[object Arguments]";function sr(e){return or(e)&&ir(e)==ar}var ur=sr,lr=ur,hr=rr,cr=Object.prototype,vr=cr.hasOwnProperty,fr=cr.propertyIsEnumerable,dr=lr(function(){return arguments}())?lr:function(e){return hr(e)&&vr.call(e,"callee")&&!fr.call(e,"callee")},yr=dr,pr=Array.isArray,mr=pr,gr={exports:{}};function br(){return!1}var wr=br;(function(e,t){var n=Ae,r=wr,i=t&&!t.nodeType&&t,o=i&&e&&!e.nodeType&&e,a=o&&o.exports===i,s=a?n.Buffer:void 0,u=s?s.isBuffer:void 0,l=u||r;e.exports=l})(gr,gr.exports);var xr=Ze,kr=In,Sr=rr,Pr="[object Arguments]",Dr="[object Array]",Mr="[object Boolean]",Ar="[object Date]",Cr="[object Error]",Or="[object Function]",Tr="[object Map]",jr="[object Number]",Ir="[object Object]",Lr="[object RegExp]",Fr="[object Set]",Er="[object String]",_r="[object WeakMap]",Rr="[object ArrayBuffer]",zr="[object DataView]",Ur="[object Float32Array]",Wr="[object Float64Array]",Gr="[object Int8Array]",Br="[object Int16Array]",Kr="[object Int32Array]",Nr="[object Uint8Array]",Yr="[object Uint8ClampedArray]",Xr="[object Uint16Array]",$r="[object Uint32Array]",qr={};function Zr(e){return Sr(e)&&kr(e.length)&&!!qr[xr(e)]}qr[Ur]=qr[Wr]=qr[Gr]=qr[Br]=qr[Kr]=qr[Nr]=qr[Yr]=qr[Xr]=qr[$r]=!0,qr[Pr]=qr[Dr]=qr[Rr]=qr[Mr]=qr[zr]=qr[Ar]=qr[Cr]=qr[Or]=qr[Tr]=qr[jr]=qr[Ir]=qr[Lr]=qr[Fr]=qr[Er]=qr[_r]=!1;var Vr=Zr;function Jr(e){return function(t){return e(t)}}var Hr=Jr,Qr={exports:{}};(function(e,t){var n=Se,r=t&&!t.nodeType&&t,i=r&&e&&!e.nodeType&&e,o=i&&i.exports===r,a=o&&n.process,s=function(){try{var e=i&&i.require&&i.require("util").types;return e||a&&a.binding&&a.binding("util")}catch(t){}}();e.exports=s})(Qr,Qr.exports);var ei=Vr,ti=Hr,ni=Qr.exports,ri=ni&&ni.isTypedArray,ii=ri?ti(ri):ei,oi=ii,ai=tr,si=yr,ui=mr,li=gr.exports,hi=Wn,ci=oi,vi=Object.prototype,fi=vi.hasOwnProperty;function di(e,t){var n=ui(e),r=!n&&si(e),i=!n&&!r&&li(e),o=!n&&!r&&!i&&ci(e),a=n||r||i||o,s=a?ai(e.length,String):[],u=s.length;for(var l in e)!t&&!fi.call(e,l)||a&&("length"==l||i&&("offset"==l||"parent"==l)||o&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||hi(l,u))||s.push(l);return s}var yi=di;function pi(e,t){return function(n){return e(t(n))}}var mi=pi,gi=mi,bi=gi(Object.keys,Object),wi=bi,xi=Qn,ki=wi,Si=Object.prototype,Pi=Si.hasOwnProperty;function Di(e){if(!xi(e))return ki(e);var t=[];for(var n in Object(e))Pi.call(e,n)&&"constructor"!=n&&t.push(n);return t}var Mi=Di,Ai=yi,Ci=Mi,Oi=_n;function Ti(e){return Oi(e)?Ai(e):Ci(e)}var ji=Ti,Ii=Zt,Li=Qt,Fi=Vn,Ei=_n,_i=Qn,Ri=ji,zi=Object.prototype,Ui=zi.hasOwnProperty,Wi=Fi((function(e,t){if(_i(t)||Ei(t))Li(t,Ri(t),e);else for(var n in t)Ui.call(t,n)&&Ii(e,n,t[n])})),Gi=Wi;function Bi(e,t){var n=-1,r=null==e?0:e.length,i=Array(r);while(++n<r)i[n]=t(e[n],n,e);return i}var Ki=Bi,Ni=Ze,Yi=rr,Xi="[object Symbol]";function $i(e){return"symbol"==typeof e||Yi(e)&&Ni(e)==Xi}var qi=$i,Zi=Te,Vi=Ki,Ji=mr,Hi=qi,Qi=1/0,eo=Zi?Zi.prototype:void 0,to=eo?eo.toString:void 0;function no(e){if("string"==typeof e)return e;if(Ji(e))return Vi(e,no)+"";if(Hi(e))return to?to.call(e):"";var t=e+"";return"0"==t&&1/e==-Qi?"-0":t}var ro=no,io=ro;function oo(e){return null==e?"":io(e)}var ao=oo,so=ao,uo=0;function lo(e){var t=++uo;return so(e)+t}var ho=lo;function co(e,t){var n=-1,r=null==e?0:e.length;while(++n<r)if(!1===t(e[n],n,e))break;return e}var vo=co;function fo(e){return function(t,n,r){var i=-1,o=Object(t),a=r(t),s=a.length;while(s--){var u=a[e?s:++i];if(!1===n(o[u],u,o))break}return t}}var yo=fo,po=yo,mo=po(),go=mo,bo=go,wo=ji;function xo(e,t){return e&&bo(e,t,wo)}var ko=xo,So=_n;function Po(e,t){return function(n,r){if(null==n)return n;if(!So(n))return e(n,r);var i=n.length,o=t?i:-1,a=Object(n);while(t?o--:++o<i)if(!1===r(a[o],o,a))break;return n}}var Do=Po,Mo=ko,Ao=Do,Co=Ao(Mo),Oo=Co,To=tn;function jo(e){return"function"==typeof e?e:To}var Io=jo,Lo=vo,Fo=Oo,Eo=Io,_o=mr;function Ro(e,t){var n=_o(e)?Lo:Fo;return n(e,Eo(t))}var zo=Ro,Uo=mr,Wo=qi,Go=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Bo=/^\w*$/;function Ko(e,t){if(Uo(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!Wo(e))||(Bo.test(e)||!Go.test(e)||null!=t&&e in Object(t))}var No=Ko,Yo=Et,Xo=Yo(Object,"create"),$o=Xo,qo=$o;function Zo(){this.__data__=qo?qo(null):{},this.size=0}var Vo=Zo;function Jo(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var Ho=Jo,Qo=$o,ea="__lodash_hash_undefined__",ta=Object.prototype,na=ta.hasOwnProperty;function ra(e){var t=this.__data__;if(Qo){var n=t[e];return n===ea?void 0:n}return na.call(t,e)?t[e]:void 0}var ia=ra,oa=$o,aa=Object.prototype,sa=aa.hasOwnProperty;function ua(e){var t=this.__data__;return oa?void 0!==t[e]:sa.call(t,e)}var la=ua,ha=$o,ca="__lodash_hash_undefined__";function va(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=ha&&void 0===t?ca:t,this}var fa=va,da=Vo,ya=Ho,pa=ia,ma=la,ga=fa;function ba(e){var t=-1,n=null==e?0:e.length;this.clear();while(++t<n){var r=e[t];this.set(r[0],r[1])}}ba.prototype.clear=da,ba.prototype["delete"]=ya,ba.prototype.get=pa,ba.prototype.has=ma,ba.prototype.set=ga;var wa=ba;function xa(){this.__data__=[],this.size=0}var ka=xa,Sa=Kt;function Pa(e,t){var n=e.length;while(n--)if(Sa(e[n][0],t))return n;return-1}var Da=Pa,Ma=Da,Aa=Array.prototype,Ca=Aa.splice;function Oa(e){var t=this.__data__,n=Ma(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():Ca.call(t,n,1),--this.size,!0}var Ta=Oa,ja=Da;function Ia(e){var t=this.__data__,n=ja(t,e);return n<0?void 0:t[n][1]}var La=Ia,Fa=Da;function Ea(e){return Fa(this.__data__,e)>-1}var _a=Ea,Ra=Da;function za(e,t){var n=this.__data__,r=Ra(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}var Ua=za,Wa=ka,Ga=Ta,Ba=La,Ka=_a,Na=Ua;function Ya(e){var t=-1,n=null==e?0:e.length;this.clear();while(++t<n){var r=e[t];this.set(r[0],r[1])}}Ya.prototype.clear=Wa,Ya.prototype["delete"]=Ga,Ya.prototype.get=Ba,Ya.prototype.has=Ka,Ya.prototype.set=Na;var Xa=Ya,$a=Et,qa=Ae,Za=$a(qa,"Map"),Va=Za,Ja=wa,Ha=Xa,Qa=Va;function es(){this.size=0,this.__data__={hash:new Ja,map:new(Qa||Ha),string:new Ja}}var ts=es;function ns(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}var rs=ns,is=rs;function os(e,t){var n=e.__data__;return is(t)?n["string"==typeof t?"string":"hash"]:n.map}var as=os,ss=as;function us(e){var t=ss(this,e)["delete"](e);return this.size-=t?1:0,t}var ls=us,hs=as;function cs(e){return hs(this,e).get(e)}var vs=cs,fs=as;function ds(e){return fs(this,e).has(e)}var ys=ds,ps=as;function ms(e,t){var n=ps(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}var gs=ms,bs=ts,ws=ls,xs=vs,ks=ys,Ss=gs;function Ps(e){var t=-1,n=null==e?0:e.length;this.clear();while(++t<n){var r=e[t];this.set(r[0],r[1])}}Ps.prototype.clear=bs,Ps.prototype["delete"]=ws,Ps.prototype.get=xs,Ps.prototype.has=ks,Ps.prototype.set=Ss;var Ds=Ps,Ms=Ds,As="Expected a function";function Cs(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(As);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=e.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(Cs.Cache||Ms),n}Cs.Cache=Ms;var Os=Cs,Ts=Os,js=500;function Is(e){var t=Ts(e,(function(e){return n.size===js&&n.clear(),e})),n=t.cache;return t}var Ls=Is,Fs=Ls,Es=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,_s=/\\(\\)?/g,Rs=Fs((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Es,(function(e,n,r,i){t.push(r?i.replace(_s,"$1"):n||e)})),t})),zs=Rs,Us=mr,Ws=No,Gs=zs,Bs=ao;function Ks(e,t){return Us(e)?e:Ws(e,t)?[e]:Gs(Bs(e))}var Ns=Ks,Ys=qi,Xs=1/0;function $s(e){if("string"==typeof e||Ys(e))return e;var t=e+"";return"0"==t&&1/e==-Xs?"-0":t}var qs=$s,Zs=Ns,Vs=qs;function Js(e,t){t=Zs(t,e);var n=0,r=t.length;while(null!=e&&n<r)e=e[Vs(t[n++])];return n&&n==r?e:void 0}var Hs=Js,Qs=Hs;function eu(e,t,n){var r=null==e?void 0:Qs(e,t);return void 0===r?n:r}var tu=eu,nu=Ze,ru=rr,iu="[object Number]";function ou(e){return"number"==typeof e||ru(e)&&nu(e)==iu}var au=ou;function su(e,t){var n=-1,r=null==e?0:e.length,i=0,o=[];while(++n<r){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o}var uu=su,lu=Oo;function hu(e,t){var n=[];return lu(e,(function(e,r,i){t(e,r,i)&&n.push(e)})),n}var cu=hu,vu=Xa;function fu(){this.__data__=new vu,this.size=0}var du=fu;function yu(e){var t=this.__data__,n=t["delete"](e);return this.size=t.size,n}var pu=yu;function mu(e){return this.__data__.get(e)}var gu=mu;function bu(e){return this.__data__.has(e)}var wu=bu,xu=Xa,ku=Va,Su=Ds,Pu=200;function Du(e,t){var n=this.__data__;if(n instanceof xu){var r=n.__data__;if(!ku||r.length<Pu-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Su(r)}return n.set(e,t),this.size=n.size,this}var Mu=Du,Au=Xa,Cu=du,Ou=pu,Tu=gu,ju=wu,Iu=Mu;function Lu(e){var t=this.__data__=new Au(e);this.size=t.size}Lu.prototype.clear=Cu,Lu.prototype["delete"]=Ou,Lu.prototype.get=Tu,Lu.prototype.has=ju,Lu.prototype.set=Iu;var Fu=Lu,Eu="__lodash_hash_undefined__";function _u(e){return this.__data__.set(e,Eu),this}var Ru=_u;function zu(e){return this.__data__.has(e)}var Uu=zu,Wu=Ds,Gu=Ru,Bu=Uu;function Ku(e){var t=-1,n=null==e?0:e.length;this.__data__=new Wu;while(++t<n)this.add(e[t])}Ku.prototype.add=Ku.prototype.push=Gu,Ku.prototype.has=Bu;var Nu=Ku;function Yu(e,t){var n=-1,r=null==e?0:e.length;while(++n<r)if(t(e[n],n,e))return!0;return!1}var Xu=Yu;function $u(e,t){return e.has(t)}var qu=$u,Zu=Nu,Vu=Xu,Ju=qu,Hu=1,Qu=2;function el(e,t,n,r,i,o){var a=n&Hu,s=e.length,u=t.length;if(s!=u&&!(a&&u>s))return!1;var l=o.get(e),h=o.get(t);if(l&&h)return l==t&&h==e;var c=-1,v=!0,f=n&Qu?new Zu:void 0;o.set(e,t),o.set(t,e);while(++c<s){var d=e[c],y=t[c];if(r)var p=a?r(y,d,c,t,e,o):r(d,y,c,e,t,o);if(void 0!==p){if(p)continue;v=!1;break}if(f){if(!Vu(t,(function(e,t){if(!Ju(f,t)&&(d===e||i(d,e,n,r,o)))return f.push(t)}))){v=!1;break}}else if(d!==y&&!i(d,y,n,r,o)){v=!1;break}}return o["delete"](e),o["delete"](t),v}var tl=el,nl=Ae,rl=nl.Uint8Array,il=rl;function ol(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}var al=ol;function sl(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var ul=sl,ll=Te,hl=il,cl=Kt,vl=tl,fl=al,dl=ul,yl=1,pl=2,ml="[object Boolean]",gl="[object Date]",bl="[object Error]",wl="[object Map]",xl="[object Number]",kl="[object RegExp]",Sl="[object Set]",Pl="[object String]",Dl="[object Symbol]",Ml="[object ArrayBuffer]",Al="[object DataView]",Cl=ll?ll.prototype:void 0,Ol=Cl?Cl.valueOf:void 0;function Tl(e,t,n,r,i,o,a){switch(n){case Al:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Ml:return!(e.byteLength!=t.byteLength||!o(new hl(e),new hl(t)));case ml:case gl:case xl:return cl(+e,+t);case bl:return e.name==t.name&&e.message==t.message;case kl:case Pl:return e==t+"";case wl:var s=fl;case Sl:var u=r&yl;if(s||(s=dl),e.size!=t.size&&!u)return!1;var l=a.get(e);if(l)return l==t;r|=pl,a.set(e,t);var h=vl(s(e),s(t),r,i,o,a);return a["delete"](e),h;case Dl:if(Ol)return Ol.call(e)==Ol.call(t)}return!1}var jl=Tl;function Il(e,t){var n=-1,r=t.length,i=e.length;while(++n<r)e[i+n]=t[n];return e}var Ll=Il,Fl=Ll,El=mr;function _l(e,t,n){var r=t(e);return El(e)?r:Fl(r,n(e))}var Rl=_l;function zl(){return[]}var Ul=zl,Wl=uu,Gl=Ul,Bl=Object.prototype,Kl=Bl.propertyIsEnumerable,Nl=Object.getOwnPropertySymbols,Yl=Nl?function(e){return null==e?[]:(e=Object(e),Wl(Nl(e),(function(t){return Kl.call(e,t)})))}:Gl,Xl=Yl,$l=Rl,ql=Xl,Zl=ji;function Vl(e){return $l(e,Zl,ql)}var Jl=Vl,Hl=Jl,Ql=1,eh=Object.prototype,th=eh.hasOwnProperty;function nh(e,t,n,r,i,o){var a=n&Ql,s=Hl(e),u=s.length,l=Hl(t),h=l.length;if(u!=h&&!a)return!1;var c=u;while(c--){var v=s[c];if(!(a?v in t:th.call(t,v)))return!1}var f=o.get(e),d=o.get(t);if(f&&d)return f==t&&d==e;var y=!0;o.set(e,t),o.set(t,e);var p=a;while(++c<u){v=s[c];var m=e[v],g=t[v];if(r)var b=a?r(g,m,v,t,e,o):r(m,g,v,e,t,o);if(!(void 0===b?m===g||i(m,g,n,r,o):b)){y=!1;break}p||(p="constructor"==v)}if(y&&!p){var w=e.constructor,x=t.constructor;w==x||!("constructor"in e)||!("constructor"in t)||"function"==typeof w&&w instanceof w&&"function"==typeof x&&x instanceof x||(y=!1)}return o["delete"](e),o["delete"](t),y}var rh=nh,ih=Et,oh=Ae,ah=ih(oh,"DataView"),sh=ah,uh=Et,lh=Ae,hh=uh(lh,"Promise"),ch=hh,vh=Et,fh=Ae,dh=vh(fh,"Set"),yh=dh,ph=Et,mh=Ae,gh=ph(mh,"WeakMap"),bh=gh,wh=sh,xh=Va,kh=ch,Sh=yh,Ph=bh,Dh=Ze,Mh=pt,Ah="[object Map]",Ch="[object Object]",Oh="[object Promise]",Th="[object Set]",jh="[object WeakMap]",Ih="[object DataView]",Lh=Mh(wh),Fh=Mh(xh),Eh=Mh(kh),_h=Mh(Sh),Rh=Mh(Ph),zh=Dh;(wh&&zh(new wh(new ArrayBuffer(1)))!=Ih||xh&&zh(new xh)!=Ah||kh&&zh(kh.resolve())!=Oh||Sh&&zh(new Sh)!=Th||Ph&&zh(new Ph)!=jh)&&(zh=function(e){var t=Dh(e),n=t==Ch?e.constructor:void 0,r=n?Mh(n):"";if(r)switch(r){case Lh:return Ih;case Fh:return Ah;case Eh:return Oh;case _h:return Th;case Rh:return jh}return t});var Uh=zh,Wh=Fu,Gh=tl,Bh=jl,Kh=rh,Nh=Uh,Yh=mr,Xh=gr.exports,$h=oi,qh=1,Zh="[object Arguments]",Vh="[object Array]",Jh="[object Object]",Hh=Object.prototype,Qh=Hh.hasOwnProperty;function ec(e,t,n,r,i,o){var a=Yh(e),s=Yh(t),u=a?Vh:Nh(e),l=s?Vh:Nh(t);u=u==Zh?Jh:u,l=l==Zh?Jh:l;var h=u==Jh,c=l==Jh,v=u==l;if(v&&Xh(e)){if(!Xh(t))return!1;a=!0,h=!1}if(v&&!h)return o||(o=new Wh),a||$h(e)?Gh(e,t,n,r,i,o):Bh(e,t,u,n,r,i,o);if(!(n&qh)){var f=h&&Qh.call(e,"__wrapped__"),d=c&&Qh.call(t,"__wrapped__");if(f||d){var y=f?e.value():e,p=d?t.value():t;return o||(o=new Wh),i(y,p,n,r,o)}}return!!v&&(o||(o=new Wh),Kh(e,t,n,r,i,o))}var tc=ec,nc=tc,rc=rr;function ic(e,t,n,r,i){return e===t||(null==e||null==t||!rc(e)&&!rc(t)?e!==e&&t!==t:nc(e,t,n,r,ic,i))}var oc=ic,ac=Fu,sc=oc,uc=1,lc=2;function hc(e,t,n,r){var i=n.length,o=i,a=!r;if(null==e)return!o;e=Object(e);while(i--){var s=n[i];if(a&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}while(++i<o){s=n[i];var u=s[0],l=e[u],h=s[1];if(a&&s[2]){if(void 0===l&&!(u in e))return!1}else{var c=new ac;if(r)var v=r(l,h,u,e,t,c);if(!(void 0===v?sc(h,l,uc|lc,r,c):v))return!1}}return!0}var cc=hc,vc=Je;function fc(e){return e===e&&!vc(e)}var dc=fc,yc=dc,pc=ji;function mc(e){var t=pc(e),n=t.length;while(n--){var r=t[n],i=e[r];t[n]=[r,i,yc(i)]}return t}var gc=mc;function bc(e,t){return function(n){return null!=n&&(n[e]===t&&(void 0!==t||e in Object(n)))}}var wc=bc,xc=cc,kc=gc,Sc=wc;function Pc(e){var t=kc(e);return 1==t.length&&t[0][2]?Sc(t[0][0],t[0][1]):function(n){return n===e||xc(n,e,t)}}var Dc=Pc;function Mc(e,t){return null!=e&&t in Object(e)}var Ac=Mc,Cc=Ns,Oc=yr,Tc=mr,jc=Wn,Ic=In,Lc=qs;function Fc(e,t,n){t=Cc(t,e);var r=-1,i=t.length,o=!1;while(++r<i){var a=Lc(t[r]);if(!(o=null!=e&&n(e,a)))break;e=e[a]}return o||++r!=i?o:(i=null==e?0:e.length,!!i&&Ic(i)&&jc(a,i)&&(Tc(e)||Oc(e)))}var Ec=Fc,_c=Ac,Rc=Ec;function zc(e,t){return null!=e&&Rc(e,t,_c)}var Uc=zc,Wc=oc,Gc=tu,Bc=Uc,Kc=No,Nc=dc,Yc=wc,Xc=qs,$c=1,qc=2;function Zc(e,t){return Kc(e)&&Nc(t)?Yc(Xc(e),t):function(n){var r=Gc(n,e);return void 0===r&&r===t?Bc(n,e):Wc(t,r,$c|qc)}}var Vc=Zc;function Jc(e){return function(t){return null==t?void 0:t[e]}}var Hc=Jc,Qc=Hs;function ev(e){return function(t){return Qc(t,e)}}var tv=ev,nv=Hc,rv=tv,iv=No,ov=qs;function av(e){return iv(e)?nv(ov(e)):rv(e)}var sv=av,uv=Dc,lv=Vc,hv=tn,cv=mr,vv=sv;function fv(e){return"function"==typeof e?e:null==e?hv:"object"==typeof e?cv(e)?lv(e[0],e[1]):uv(e):vv(e)}var dv=fv,yv=uu,pv=cu,mv=dv,gv=mr;function bv(e,t){var n=gv(e)?yv:pv;return n(e,mv(t))}var wv,xv,kv,Sv,Pv,Dv,Mv,Av=bv;(function(e){e["Left"]="left",e["Right"]="right"})(wv||(wv={})),function(e){e["Top"]="top",e["Bottom"]="bottom"}(xv||(xv={})),function(e){e["Bottom"]="bottom",e["Top"]="top",e["Middle"]="middle"}(kv||(kv={})),function(e){e["Pan"]="PAN",e["Ban"]="BAN",e["MARKER"]="MARKER",e["Point"]="POINT",e["Circle"]="CIRCLE",e["Line"]="LINE",e["Polyline"]="POLYLINE",e["Rect"]="RECT",e["Polygon"]="POLYGON",e["DrawMask"]="DRAWMASK",e["ClearMask"]="CLEARMASK",e["ImageMask"]="IMAGEMASK"}(Sv||(Sv={})),function(e){e["BoundsChanged"]="boundsChanged",e["FeatureSelected"]="featureSelected",e["FeatureUnselected"]="featureUnselected",e["DrawDone"]="drawDone",e["FeatureUpdated"]="featureUpdated",e["FeatureDeleted"]="featureDeleted",e["Click"]="click",e["DblClick"]="dblClick",e["MouseDown"]="mouseDown",e["MouseMove"]="mouseMove",e["MouseUp"]="mouseUp",e["MouseOver"]="mouseOver",e["MouseOut"]="mouseOut"}(Pv||(Pv={})),function(e){e["Grab"]="-webkit-grab",e["Grabbing"]="-webkit-grabbing",e["Crosshair"]="crosshair",e["Pointer"]="pointer",e["Move"]="move",e["NESW_Resize"]="nesw-resize",e["NWSE_Resize"]="nwse-resize"}(Dv||(Dv={})),function(e){e["DrawMask"]="crosshair",e["ClearMask"]="crosshair"}(Mv||(Mv={}));var Cv=Oo,Ov=_n;function Tv(e,t){var n=-1,r=Ov(e)?Array(e.length):[];return Cv(e,(function(e,i,o){r[++n]=t(e,i,o)})),r}var jv=Tv,Iv=Ki,Lv=dv,Fv=jv,Ev=mr;function _v(e,t){var n=Ev(e)?Iv:Fv;return n(e,Lv(t))}var Rv=_v;function zv(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}var Uv=zv;function Wv(e,t,n,r){var i=e.length,o=n+(r?1:-1);while(r?o--:++o<i)if(t(e[o],o,e))return o;return-1}var Gv=Wv;function Bv(e){return e!==e}var Kv=Bv;function Nv(e,t,n){var r=n-1,i=e.length;while(++r<i)if(e[r]===t)return r;return-1}var Yv=Nv,Xv=Gv,$v=Kv,qv=Yv;function Zv(e,t,n){return t===t?qv(e,t,n):Xv(e,$v,n)}var Vv=Zv,Jv=Ze,Hv=mr,Qv=rr,ef="[object String]";function tf(e){return"string"==typeof e||!Hv(e)&&Qv(e)&&Jv(e)==ef}var nf=tf,rf=/\s/;function of(e){var t=e.length;while(t--&&rf.test(e.charAt(t)));return t}var af=of,sf=af,uf=/^\s+/;function lf(e){return e?e.slice(0,sf(e)+1).replace(uf,""):e}var hf=lf,cf=hf,vf=Je,ff=qi,df=NaN,yf=/^[-+]0x[0-9a-f]+$/i,pf=/^0b[01]+$/i,mf=/^0o[0-7]+$/i,gf=parseInt;function bf(e){if("number"==typeof e)return e;if(ff(e))return df;if(vf(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=vf(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=cf(e);var n=pf.test(e);return n||mf.test(e)?gf(e.slice(2),n?2:8):yf.test(e)?df:+e}var wf=bf,xf=wf,kf=1/0,Sf=17976931348623157e292;function Pf(e){if(!e)return 0===e?e:0;if(e=xf(e),e===kf||e===-kf){var t=e<0?-1:1;return t*Sf}return e===e?e:0}var Df=Pf,Mf=Df;function Af(e){var t=Mf(e),n=t%1;return t===t?n?t-n:t:0}var Cf=Af,Of=Ki;function Tf(e,t){return Of(t,(function(t){return e[t]}))}var jf=Tf,If=jf,Lf=ji;function Ff(e){return null==e?[]:If(e,Lf(e))}var Ef=Ff,_f=Vv,Rf=_n,zf=nf,Uf=Cf,Wf=Ef,Gf=Math.max;function Bf(e,t,n,r){e=Rf(e)?e:Wf(e),n=n&&!r?Uf(n):0;var i=e.length;return n<0&&(n=Gf(i+n,0)),zf(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&_f(e,t,n)>-1}var Kf,Nf=Bf;(function(e){e["Draw"]="DRAW",e["Clear"]="CLEAR",e["Image"]="IMAGE"})(Kf||(Kf={}));var Yf=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};r(this,e),this.id=t,this.type=n,this.props=i,this.style=Gi({},e.defaultStyle,o)}return o(e,[{key:"onAdd",value:function(e){this.layer=e,this.refresh()}},{key:"onRemove",value:function(){}},{key:"setStyle",value:function(e,t){var n,r=t.refresh,i=void 0===r||r;this.style=e,i&&(null===(n=this.layer)||void 0===n||n.refresh())}},{key:"refresh",value:function(){}},{key:"printInfo",value:function(){}}]),e}();a(Yf,"defaultStyle",{opacity:1,fillStyle:"rgba(255, 0, 0, 0)",lineWidth:1,strokeStyle:"#000"});var Xf=Ze,$f=rr,qf="[object Boolean]";function Zf(e){return!0===e||!1===e||$f(e)&&Xf(e)==qf}var Vf=Zf,Jf=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};r(this,e),this.id=t,this.type=n,this.props=i,this.style=Gi({},e.defaultStyle,o),this.domId="layer-".concat(t,"-wrapper"),this.setDom()}return o(e,[{key:"setDom",value:function(){this.dom||(this.dom=document.createElement("div"),this.dom.setAttribute("id",this.domId),this.dom.style.position="absolute",this.dom.style.left="0",this.dom.style.top="0");var e=this.style,t=e.zIndex,n=e.opacity;this.dom.style.zIndex="".concat(t),this.dom.style.opacity="".concat(n)}},{key:"onAdd",value:function(e){this.map=e,this.resize()}},{key:"onRemove",value:function(){var e=document.getElementById(this.domId);e&&e.remove()}},{key:"resize",value:function(){var e=this.map.getSize(),t=e.width,n=e.height;this.dom.style.width="".concat(t,"px"),this.dom.style.height="".concat(n,"px")}},{key:"refresh",value:function(){}},{key:"resizeAndRefresh",value:function(){this.resize(),this.refresh()}},{key:"printInfo",value:function(){}}]),e}();a(Jf,"defaultStyle",{zIndex:1,opacity:1});var Hf=function(e){s(n,e);var t=f(n);function n(e,i){var o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return r(this,n),o=t.call(this,e,i,a,s),o.createRenderCanvas(),o}return o(n,[{key:"onAdd",value:function(e){y(u(n.prototype),"onAdd",this).call(this,e),this.resize()}},{key:"createRenderCanvas",value:function(){this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.left="0",this.canvas.style.top="0",this.dom.appendChild(this.canvas),this.canvasContext=this.canvas.getContext("2d")}},{key:"resize",value:function(){y(u(n.prototype),"resize",this).call(this);var e=this.map.getSize(),t=e.width,r=e.height;this.canvas.width=t*n.dpr,this.canvas.height=r*n.dpr,this.canvas.style.width=t+"px",this.canvas.style.height=r+"px"}},{key:"refresh",value:function(){this.clear(),y(u(n.prototype),"refresh",this).call(this)}},{key:"clear",value:function(){var e;null===(e=this.canvasContext)||void 0===e||e.clearRect(0,0,this.canvas.width,this.canvas.height)}}]),n}(Jf);a(Hf,"dpr",window.devicePixelRatio);var Qf=function(){function e(){r(this,e)}return o(e,null,[{key:"setStyle",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=Gi({},e.defaultStyle,n);zo(r,(function(n,r){if(ot(e.formatStyle[r])){var i=e.formatStyle[r](n);!ot(t[r])&&(t[r]=i)}else!ot(t[r])&&(t[r]=n)}))}},{key:"drawPolyline",value:function(t,n,r,i){var o=i.format,a=i.limitCount,s=void 0===a?2:a,u=ot(o)?o(n):n,l=u.points,h=u.width,c=l.length;if(!(c<s)){e.setStyle(t,r),au(h)&&(t.lineWidth=h),t.beginPath();var v=l[0],f=v.x,d=v.y;t.moveTo(f,d);for(var y=1;y<c;y++){var p=l[y],m=p.x,g=p.y;t.lineTo(m,g)}t.stroke()}}},{key:"drawLine",value:function(t,n,r,i){e.setStyle(t,r);var o=i||{},a=o.format,s=ot(a)?a(n):n,u=s.start,l=s.end,h=s.width;au(h)&&(t.lineWidth=h),t.beginPath(),t.moveTo(u.x,u.y),t.lineTo(l.x,l.y),t.stroke()}},{key:"drawRect",value:function(t,n,r,i){var o=i||{},a=o.format,s=!Vf(r.stroke)||r.stroke,u=!!Vf(r.fill)&&r.fill,l=ot(a)?a(n):n,h=l.x,c=l.y,v=l.width,f=l.height,d=h+v,y=c+f,p=[{x:h,y:c},{x:d,y:c},{x:d,y:y},{x:h,y:y}];e.drawPolygon(t,p,r,{fill:u,stroke:s})}},{key:"drawPolygon",value:function(t,n,r,i){var o=i.format,a=i.limitCount,s=void 0===a?2:a,u=i.closePath,l=void 0===u||u,h=!Vf(r.stroke)||r.stroke,c=!!Vf(r.fill)&&r.fill,v=n.length;if(!(v<s)){e.setStyle(t,r),t.beginPath();var f=ot(o)?o(n[0]):n[0],d=f.x,y=f.y;t.moveTo(d,y);for(var p=1;p<v;p++){var m=ot(o)?o(n[p]):n[p],g=m.x,b=m.y;t.lineTo(g,b)}l&&t.closePath(),c&&t.fill(),h&&(t.globalAlpha=1,t.stroke())}}},{key:"drawCircle",value:function(t,n,r,i){var o=i.format,a=!Vf(r.stroke)||r.stroke,s=!!Vf(r.fill)&&r.fill,u=ot(o)?o(n):n,l=u.cx,h=u.cy,c=u.r;e.setStyle(t,r),t.beginPath(),t.arc(l,h,c,0,2*Math.PI),s&&t.fill(),a&&(t.globalAlpha=1,t.stroke())}},{key:"drawPoint",value:function(t,n,r,i){var o=i.format,a=ot(o)?o(n):n,s=a.x,u=a.y,l=a.r,h=void 0===l?2:l;e.setStyle(t,r),t.beginPath(),t.arc(s,u,h,0,2*Math.PI),t.fill()}},{key:"drawImage",value:function(e,t,n){var r=t.image,i=t.x,o=t.y,a=t.width,s=t.height;e.drawImage(r,i,o,a,s)}},{key:"drawText",value:function(t,r,i,o){var a=i.background,s=o.format,u=!Vf(i.fill)||i.fill,l=ot(s)?s(r):r,h=l.text,c=l.position,v=l.offset;if(h){e.setStyle(t,i);var f=c.x+v.x,d=c.y-v.y,y=t.lineWidth,p=3*Hf.dpr,m=4*Hf.dpr,g=t.textBaseline===kv.Bottom,b=t.textBaseline===kv.Top,w=t.textBaseline===kv.Middle;if(a){var x=t.measureText(h).width,k=parseInt(t.font.replace(/[^0-9.]/gi,""),10),S=x+2*m,P=k+2*p,D=c.y;g&&(D-=P),b&&(D=D),w&&(D-=P/2);var M={x:c.x+v.x,y:D-v.y,width:S,height:P};e.drawRect(t,M,n(n({},i||{}),{},{fill:!0}))}t.globalAlpha=1,u?(t.fillStyle=i.fontColor,g&&a&&t.fillText(h,f+m,d-p+y),w&&a&&t.fillText(h,f+m,d),b&&a&&t.fillText(h,f+m,d+p+y),!a&&t.fillText(h,f,d)):(t.strokeStyle=i.fontColor,g&&a&&t.strokeText(h,f+m,d-p+y),w&&a&&t.strokeText(h,f+m,d),b&&a&&t.strokeText(h,f+m,d+p+y),!a&&t.strokeText(h,f,d))}}}]),e}();a(Qf,"defaultStyle",{fillStyle:"#FF0000",strokeStyle:"#FF0000",lineWidth:1,font:"normal 12px Arial",globalAlpha:1,lineCap:"round",lineJoin:"round",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0}),a(Qf,"formatStyle",{lineWidth:function(e){return e*Hf.dpr},font:function(e){var t=e.replace(/[^0-9.]/gi,""),n=parseInt(t,10)*Hf.dpr,r=new RegExp("".concat(t),"g"),i=e.replace(r,"".concat(n));return i}});var ed,td,nd,rd=function(e){s(i,e);var t=f(i);function i(e,n){var o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return r(this,i),o=t.call(this,e,Kf.Clear,a,s),o.shape=n,o}return o(i,[{key:"refresh",value:function(){var e=this,t=Hf.dpr,r=this.layer.map.getScale(),i=n(n({},this.style||{}),{},{lineCap:"round",lineJoin:"round"});this.layer.canvasContext.globalCompositeOperation="destination-out",Qf.drawPolyline(this.layer.canvasContext,this.shape,i,{format:function(i){var o=i.points,a=i.width;return n({points:Rv(o,(function(n){var r=e.layer.map.transformGlobalToScreen(n),i=r.x,o=r.y;return{x:i*t,y:o*t}}))},au(a)?{width:a*r*t}:{})}}),this.layer.canvasContext.globalCompositeOperation="source-over"}}]),i}(Yf);(function(e){e["Image"]="IMAGE",e["Feature"]="FEATURE",e["Event"]="EVENT",e["Mask"]="MASK",e["Text"]="TEXT",e["Marker"]="MARKER",e["Overlay"]="OVERLAY"})(ed||(ed={})),function(e){e["Point"]="POINT",e["Line"]="LINE",e["Polyline"]="POLYLINE",e["Polygon"]="POLYGON",e["Rect"]="RECT",e["Circle"]="CIRCLE"}(td||(td={})),function(e){e["Global"]="GLOBAL",e["Screen"]="SCREEN"}(nd||(nd={}));var id,od,ad=function e(){r(this,e)};a(ad,"MathUtil",{getMiddlePoint:function(e,t){var n=e.x,r=e.y,i=t.x,o=t.y,a=(n+i)/2,s=(r+o)/2;return{x:a,y:s}},distance:function(e,t){var n=e.x,r=e.y,i=t.x,o=t.y,a=n-i,s=r-o;return Math.sqrt(a*a+s*s)},pointInPolygon:function(e,t){for(var n=e.x,r=e.y,i=!1,o=-1,a=t.length,s=a-1;++o<a;s=o){var u=t[o],l=u.x,h=u.y,c=t[s],v=c.x,f=c.y;(h<=r&&r<f||f<=r&&r<h)&&n<(v-l)*(r-h)/(f-h)+l&&(i=!i)}return i},pointInPoint:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.tolerance,i=ad.MathUtil.distance(e,t);return i<=r},pointInPolyline:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.tolerance,i=t.length-1,o=!1;return zo(t,(function(n,a){if(a!==i){var s=t[a+1],u=ad.MathUtil.distancePoint2Line(e,n,s);return u<=r?(o=!0,!1):void 0}})),o},distancePoint2Line:function(e,t,n){var r,i,o=e.x,a=e.y,s=t.x,u=t.y,l=n.x,h=n.y,c=o-s,v=a-u,f=l-s,d=h-u,y=c*f+v*d,p=f*f+d*d,m=-1;0!==p&&(m=y/p),m<0?(r=s,i=u):m>1?(r=l,i=h):(r=s+m*f,i=u+m*d);var g=o-r,b=a-i;return Math.sqrt(g*g+b*b)}}),a(ad,"EventUtil",{getButtonIndex:function(e){if(!+[1])switch(e.button){case 0:case 1:case 3:case 5:case 7:return 0;case 2:case 6:return 2;case 4:return 1}return e.button},getMouseDirection:function(e,t){var n=e.offsetLeft,r=-e.offsetTop,i=n+e.offsetWidth,o=r-e.offsetHeight,a=(n+i)/2,s=(r+o)/2,u=(o-r)/(i-n),l=t||window.event,h=l.clientX,c=-l.clientY,v=(c-s)/(h-a);return u<v&&v<-u?h>a?1:3:c>s?0:2}}),function(e){e["Marker"]="MARKER"}(id||(id={})),function(e){e["Click"]="click",e["MouseDown"]="mouseDown",e["MouseUp"]="mouseUp",e["MouseOver"]="mouseOver",e["MouseOut"]="mouseOut",e["DragStart"]="dragStart",e["Dragging"]="dragging",e["DragEnd"]="dragEnd",e["RightClick"]="rightClick"}(od||(od={}));var sd=function(e){s(i,e);var t=f(i);function i(e){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(this,i),n=t.call(this,e,ed.Event,o,s),a(c(n),"dragging",!1),a(c(n),"tmpPointsStore",[]),a(c(n),"hoverFeature",null),a(c(n),"hoverFeatureIndex",void 0),n.onMouseDown=n.onMouseDown.bind(c(n)),n.onMouseMove=n.onMouseMove.bind(c(n)),n.onMouseUp=n.onMouseUp.bind(c(n)),n.onMouseOut=n.onMouseOut.bind(c(n)),n.onMouseOver=n.onMouseOver.bind(c(n)),n.onMouseClick=n.onMouseClick.bind(c(n)),n.onMouseDblClick=n.onMouseDblClick.bind(c(n)),n.onMouseWheel=n.onMouseWheel.bind(c(n)),n}return o(i,[{key:"onAdd",value:function(e){y(u(i.prototype),"onAdd",this).call(this,e),this.createEventDom(),this.dom.appendChild(this.eventDom),this.addEventListener()}},{key:"createEventDom",value:function(){this.eventDom=document.createElement("div"),this.eventDom.style.position="absolute",this.eventDom.style.left="0",this.eventDom.style.right="0",this.eventDom.style.top="0",this.eventDom.style.bottom="0",this.eventDom.style.zIndex="1",this.eventDom.ondragstart=function(e){e.preventDefault(),e.stopPropagation()}}},{key:"addEventListener",value:function(){this.eventDom.addEventListener("mousedown",this.onMouseDown),this.eventDom.addEventListener("mousemove",this.onMouseMove),this.eventDom.addEventListener("mouseup",this.onMouseUp),this.eventDom.addEventListener("click",this.onMouseClick),this.eventDom.addEventListener("dblclick",this.onMouseDblClick),this.eventDom.addEventListener("mousewheel",this.onMouseWheel),this.eventDom.addEventListener("mouseout",this.onMouseOut),this.eventDom.addEventListener("mouseover",this.onMouseOver)}},{key:"removeEventListener",value:function(){this.eventDom.removeEventListener("mousedown",this.onMouseDown),this.eventDom.removeEventListener("mousemove",this.onMouseMove),this.eventDom.removeEventListener("mouseup",this.onMouseUp),this.eventDom.removeEventListener("click",this.onMouseClick),this.eventDom.removeEventListener("dblclick",this.onMouseDblClick),this.eventDom.removeEventListener("mousewheel",this.onMouseWheel),this.eventDom.removeEventListener("mouseout",this.onMouseOut),this.eventDom.removeEventListener("mouseover",this.onMouseOver)}},{key:"handleMapPanStart",value:function(e){var t=this;this.dragging=!0,this.map.setCursor(Dv.Grabbing),document.onmousemove=function(e){return t.handleMapPanMove(e)},document.onmouseup=function(e){return t.handleMapPanEnd(e)}}},{key:"handleMapPanMove",value:function(e){var t=this.getDltXY(e),n=t.x,r=t.y;this.map.onDrag(n,r)}},{key:"handleMapPanEnd",value:function(e){this.dragging=!1,this.map.setCursor(Dv.Grab),document.onmousemove=null,document.onmouseup=null;var t=this.getDltXY(e),n=t.x,r=t.y,i=this.map.getScreenCenter(),o=i.x,a=i.y,s=o-n,u=a-r,l=this.map.transformScreenToGlobal({x:s,y:u});this.map.reset().setCenter(l)}},{key:"getDltXY",value:function(e,t){var n=t||{},r=n.transform,i=void 0!==r&&r,o=this.map.getScale(),a=e.screenX,s=e.screenY,u=this.startPageScreenPoint,l=u.x,h=u.y,c=a-l,v=s-h,f=c/o,d=v/o;return{x:i?f:c,y:i?d:v}}},{key:"clearDownTimer",value:function(){this.downTimer&&(window.clearTimeout(this.downTimer),this.downTimer=null)}},{key:"handleMarkerStart",value:function(e){var t=this;this.clearDownTimer(),this.downTimer=window.setTimeout((function(){t.map.eventsObServer.emit(Pv.DrawDone,t.map.mode,{x:t.startPoint.global.x,y:t.startPoint.global.y})}),300)}},{key:"handlePointStart",value:function(e){var t=this;this.clearDownTimer(),this.downTimer=window.setTimeout((function(){t.map.eventsObServer.emit(Pv.DrawDone,t.map.mode,{x:t.startPoint.global.x,y:t.startPoint.global.y}),t.reset()}),300)}},{key:"handleCircleStart",value:function(e){var t=this;this.dragging=!0,document.onmousemove=function(e){return t.handleCircleMove(e)},document.onmouseup=function(e){return t.handleCircleEnd(e)};var n=this.startPoint.global;this.setTip({text:"移动开始绘制",position:n})}},{key:"handleCircleMove",value:function(e){var t=this.startPoint.global,n=this.getDltXY(e,{transform:!0}),r=n.x,i=n.y,o=this.getDltXY(e,{transform:!1}),a=o.x,s=o.y,u=Math.sqrt(a*a+s*s),l=this.map.xAxis.direction===wv.Right,h=this.map.yAxis.direction===xv.Top,c=l?r:-r,v=h?i:-i,f={x:t.x+c,y:t.y-v},d={cx:t.x,cy:t.y,sr:u};this.map.overlayLayer.addCircleFeature(d),this.setTip({text:"抬起完成绘制",position:f})}},{key:"handleCircleEnd",value:function(e){this.dragging=!1,document.onmousemove=null,document.onmouseup=null;var t=this.startPoint.global,n=t.x,r=t.y,i=this.getDltXY(e,{transform:!0}),o=i.x,a=i.y,s=this.getDltXY(e,{transform:!1}),u=s.x,l=s.y,h=Math.sqrt(o*o+a*a),c=Math.sqrt(u*u+l*l);if(this.reset(),Math.abs(c)<=2)console.warn("the circle is too small...");else{var v={cx:n,cy:r,r:h},f={cx:n,cy:r,sr:c};this.map.eventsObServer.emit(Pv.DrawDone,this.map.mode,v,f)}}},{key:"handleLineStart",value:function(e){var t=this;if(0===this.tmpPointsStore.length)this.clearDownTimer(),this.downTimer=window.setTimeout((function(){t.tmpPointsStore.push(t.startPoint),t.setTip({text:"移动开始绘制",position:t.startPoint.global})}),300);else if(1===this.tmpPointsStore.length){var n=this.tmpPointsStore[0].global,r=this.startPoint.global;this.map.eventsObServer.emit(Pv.DrawDone,this.map.mode,{start:n,end:r}),this.reset()}}},{key:"handleLineMove",value:function(e){var t=e.offsetX,n=e.offsetY,r={x:t,y:n},i=this.map.transformScreenToGlobal(r),o=this.tmpPointsStore.length;if(0===o)this.setTip({text:"单击确定起点",position:i});else if(1===o){var a=this.tmpPointsStore[0].global,s=this.map.transformScreenToGlobal({x:t,y:n});this.map.overlayLayer.addLineFeature({start:a,end:s}),this.setTip({text:"单击确定终点",position:i})}}},{key:"handlePolylineStart",value:function(e){var t=this;0===this.tmpPointsStore.length?(this.clearDownTimer(),this.downTimer=window.setTimeout((function(){t.tmpPointsStore.push(t.startPoint),t.setTip({text:"移动开始绘制",position:t.startPoint.global})}),300)):(this.tmpPointsStore.push(this.startPoint),this.setTip({text:"ctrl+z撤销",position:this.startPoint.global}))}},{key:"handlePolylineMove",value:function(e){var t=e.offsetX,n=e.offsetY,r=this.map.transformScreenToGlobal({x:t,y:n}),i=Rv(this.tmpPointsStore,(function(e){var t=e.global;return t}));i.push(r),1===i.length?this.setTip({text:"单击确定起点",position:r}):i.length>1&&(this.map.overlayLayer.addPolylineFeature({points:i}),this.setTip({text:"单击绘制/双击结束",position:r}))}},{key:"handlePolylineEnd",value:function(e){this.tmpPointsStore.pop(),this.tmpPointsStore.length>=2&&this.map.eventsObServer.emit(Pv.DrawDone,this.map.mode,Rv(this.tmpPointsStore,(function(e){var t=e.global;return t}))),this.reset()}},{key:"handleRectStart",value:function(e){var t=this;this.dragging=!0,document.onmousemove=function(e){return t.handleRectMove(e)},document.onmouseup=function(e){return t.handleRectEnd(e)};var n=this.startPoint.global;this.setTip({text:"移动开始绘制",position:n})}},{key:"handleRectMove",value:function(e){var t=this.startPoint.global,n=t.x,r=t.y,i=this.getDltXY(e,{transform:!0}),o=i.x,a=i.y,s=this.map.xAxis.direction===wv.Right,u=this.map.yAxis.direction===xv.Top,l=s?Math.min(n,n+o):Math.max(n,n-o),h=u?Math.max(r,r-a):Math.min(r,r+a),c={x:s?n+o:n-o,y:u?r-a:r+a},v={x:l,y:h,width:Math.abs(o),height:Math.abs(a)};this.map.overlayLayer.addRectFeature(v),this.setTip({text:"抬起完成绘制",position:c})}},{key:"handleRectEnd",value:function(e){this.dragging=!1,document.onmousemove=null,document.onmouseup=null;var t=this.map.getScale(),n=this.startPoint.screen,r=n.x,i=n.y,o=this.getDltXY(e),a=o.x,s=o.y,u=Math.abs(a)/t,l=Math.abs(s)/t,h=r+a,c=i+s,v=Math.min(h,r),f=Math.min(c,i),d=this.map.transformScreenToGlobal({x:v,y:f});if(this.reset(),Math.abs(a)<=3||Math.abs(s)<=3)console.warn("the rect is too small...");else{var y={x:d.x,y:d.y,width:u,height:l};this.map.eventsObServer.emit(Pv.DrawDone,this.map.mode,y)}}},{key:"handlePolygonStart",value:function(e){var t=this;0===this.tmpPointsStore.length?(this.clearDownTimer(),this.downTimer=window.setTimeout((function(){t.tmpPointsStore.push(t.startPoint),t.setTip({text:"移动开始绘制",position:t.startPoint.global})}),300)):(this.tmpPointsStore.push(this.startPoint),this.setTip({text:"ctrl+z撤销",position:this.startPoint.global}))}},{key:"handlePolygonMove",value:function(e){var t=e.offsetX,n=e.offsetY,r=this.map.transformScreenToGlobal({x:t,y:n}),i=Rv(this.tmpPointsStore,(function(e){var t=e.global;return t}));i.push(r);var o=i.length;if(1===o)this.setTip({text:"单击确定起点",position:r});else if(o>1){this.map.overlayLayer.addPolygonFeature({points:i},{node:!0});var a=2===o?"单击绘制":"单击绘制/双击结束";this.setTip({text:a,position:r})}}},{key:"handlePolygonEnd",value:function(e){if(this.tmpPointsStore.pop(),this.tmpPointsStore.length>=3){var t=Rv(this.tmpPointsStore,(function(e){var t=e.global;return t}));this.map.eventsObServer.emit(Pv.DrawDone,this.map.mode,t)}this.reset()}},{key:"handleMaskStart",value:function(e){var t=this;this.dragging=!0,document.onmousemove=function(e){return t.handleMaskMove(e)},document.onmouseup=function(e){return t.handleMaskEnd(e)},this.tmpPointsStore.push(this.startPoint);var n=Rv(this.tmpPointsStore,(function(e){var t=e.global;return t}));switch(this.map.mode){case Sv.DrawMask:this.map.overlayLayer.addDrawAction({points:n});break;case Sv.ClearMask:this.handleMaskClearMoving({points:n});break}}},{key:"handleMaskMove",value:function(e){var t=this.startPoint.screen,n=t.x,r=t.y,i=this.getDltXY(e),o=i.x,a=i.y,s={x:n+o,y:r+a},u=this.map.transformScreenToGlobal(s),l=Uv(this.tmpPointsStore);if(l){var h=l.screen,c=ad.MathUtil.distance(h,s);if(c<=3)return}this.tmpPointsStore.push({screen:s,global:u});var v=Rv(this.tmpPointsStore,(function(e){var t=e.global;return t}));switch(this.map.mode){case Sv.DrawMask:this.map.overlayLayer.addDrawAction({points:v});break;case Sv.ClearMask:this.handleMaskClearMoving({points:v});break}}},{key:"handleMaskEnd",value:function(e){this.dragging=!1,document.onmousemove=null,document.onmouseup=null;var t=Rv(this.tmpPointsStore,(function(e){var t=e.global;return t}));this.map.eventsObServer.emit(Pv.DrawDone,this.map.mode,t),this.reset(),this.handleMaskClearMoving({reset:!0})}},{key:"handleMaskClearMoving",value:function(e){var t=e.points,n=void 0===t?[]:t,r=e.reset,i=void 0!==r&&r,o=this.map.getLayers(),a=this.map.drawingStyle,s=a.lineWidth,u=void 0===s?10:s,l=this.map.getScale(),h=u/l;zo(o,(function(e){if(e.type!==ed.Mask||i)e.type===ed.Mask&&i&&e.setMovingClearAction(null);else{var t=new rd("".concat(+new Date),{points:n,width:h},{},a);e.setMovingClearAction(t)}}))}},{key:"handleMapZoom",value:function(e){var t=e.offsetX,n=e.offsetY,r={x:t,y:n},i=this.map.transformScreenToGlobal(r),o={screen:r,global:i},a=e.deltaY<0?95*this.map.zoom/100:105.263*this.map.zoom/100,s=this.map.getScreenCenter(),u=this.map.transformScreenToGlobal(s,{basePoint:o,zoom:a});this.map.centerAndZoom({center:u,zoom:a},{refreshDelay:!0})}},{key:"handleFeatureSelect",value:function(e){var t=this.map.getTargetFeatureWithPoint(this.startPoint.global);t&&this.map.eventsObServer.emit(Pv.FeatureSelected,t)}},{key:"handleActiveFeatureCapture",value:function(e){var t=this,n=e.offsetX,r=e.offsetY,i={x:n,y:r},o=this.map.transformScreenToGlobal(i),a=this.map.activeFeature,s=a||{},u=s.type,l=s.shape;switch(this.hoverFeature=null,this.hoverFeatureIndex=void 0,u){case td.Point:a.captureWithPoint(o)&&(this.hoverFeature=a,this.map.setCursor(Dv.Pointer),this.setTip({text:"按下移动图形/右键删除",position:o}));break;case td.Rect:case td.Circle:var h=u===td.Rect,c=h?a.getPoints():a.getEdgePoints();zo(c,(function(e,n){var r=t.map.transformGlobalToScreen(e),a=ad.MathUtil.distance(r,i);if(a<=5){t.hoverFeatureIndex=n;var s=1===n||3===n?Dv.NESW_Resize:Dv.NWSE_Resize;return t.map.setCursor(s),t.setTip({text:"按下拖动",position:o}),!1}})),!au(this.hoverFeatureIndex)&&a.captureWithPoint(o)&&(this.hoverFeature=a,this.map.setCursor(Dv.Move),this.setTip({text:"按下移动图形",position:o}));break;case td.Line:case td.Polyline:case td.Polygon:var v=u===td.Line,f=u===td.Polyline;td.Polygon;var d=l,y=d.start,p=d.end,m=l,g=m.points,b=void 0===g?[]:g,w=v?[y,p]:b,x=w.length;zo(w,(function(e,n){var r=t.map.transformGlobalToScreen(e),a=ad.MathUtil.distance(r,i);if(a<=5){t.hoverFeatureIndex=n,t.map.setCursor(Dv.Pointer);var s=v||f?2:3,u=x>s?"/右键删除":"";return t.setTip({text:"按下拖动".concat(u),position:o}),!1}if(!v){if(f&&!w[n+1])return!1;var l=w[n+1]||w[0],h=ad.MathUtil.getMiddlePoint(e,l),c=t.map.transformGlobalToScreen(h),d=ad.MathUtil.distance(c,i);return d<=5?(t.hoverFeatureIndex=n+.5,t.map.setCursor(Dv.Pointer),t.setTip({text:"按下拖动添加新节点",position:o}),!1):void 0}})),!au(this.hoverFeatureIndex)&&a.captureWithPoint(o)&&(this.hoverFeature=a,this.map.setCursor(Dv.Move),this.setTip({text:"按下移动图形",position:o}));break}}},{key:"handleActiveFeatureStart",value:function(e){var t=this;this.map.tipLayer.removeAllFeatureActionText();var n=ad.EventUtil.getButtonIndex(e);0===n?(this.dragging=!0,document.onmousemove=function(e){return t.handleActiveFeatureMove(e)},document.onmouseup=function(e){return t.handleActiveFeatureEnd(e)}):2===n&&this.handleActiveFeatureElse(e)}},{key:"handleActiveFeatureMove",value:function(e){var t=this,r=this.getDltXY(e,{transform:!0}),i=r.x,o=r.y,a=this.getDltXY(e,{transform:!1}),s=a.x;a.y;var u=this.map.activeFeature,l=u.type,h=u.shape,c=u.style,v=this.map.xAxis.direction===wv.Right,f=this.map.yAxis.direction===xv.Top,d=v?i:-i,y=f?o:-o,m=v?s:-s;switch(l){case td.Point:var g,b=h,w=b.x,x=b.y;this.toUpdateShape=n(n({},h),{},{x:w+d,y:x-y}),this.map.overlayLayer.addActiveFeature(u),this.map.overlayLayer.addPointFeature(this.toUpdateShape,{clear:!1,style:n(n({},c),{},{fillStyle:null===(g=this.map)||void 0===g?void 0:g.editingColor})});break;case td.Circle:var k,S=h,P=S.cx,D=S.cy,M=S.r,A=S.sr;if(this.hoverFeature)this.toUpdateShape=n(n({},h),{},{cx:P+d,cy:D-y});else if(au(this.hoverFeatureIndex)){0===this.hoverFeatureIndex||this.hoverFeatureIndex;var C=1===this.hoverFeatureIndex||2===this.hoverFeatureIndex,O=u.getSubType(),T=O===nd.Global,j=T?C?M+d:M-d:C?A+m:A-m;if(j<=0)return void console.warn("circle update error: invalid radius, radius <= 0");this.toUpdateShape=n(n({},h),T?{r:j}:{sr:j})}this.map.overlayLayer.addActiveFeature(u),this.map.overlayLayer.addCircleFeature(this.toUpdateShape,{clear:!1,style:n(n({},c),{},{lineWidth:1,strokeStyle:null===(k=this.map)||void 0===k?void 0:k.editingColor})});break;case td.Rect:var I,L=h,F=L.x,E=L.y,_=L.width,R=L.height,z=null;if(this.hoverFeature)z={x:F+d,y:E-y,width:_,height:R};else if(au(this.hoverFeatureIndex)){var U=0===this.hoverFeatureIndex||3===this.hoverFeatureIndex,W=0===this.hoverFeatureIndex||1===this.hoverFeatureIndex,G=U?F+d:F,B=W?E-y:E,K=U?_-i:_+i,N=W?R-o:R+o,Y=v?G+K:G-K,X=f?B-N:B+N,$=v?Math.min(G,Y):Math.max(G,Y),q=f?Math.max(B,X):Math.min(B,X),Z=Math.abs(K),V=Math.abs(N);z={x:$,y:q,width:Z,height:V}}this.toUpdateShape=n(n({},h),z),this.map.overlayLayer.addActiveFeature(u),this.map.overlayLayer.addRectFeature(this.toUpdateShape,{clear:!1,style:n(n({},c),{},{lineWidth:1,strokeStyle:null===(I=this.map)||void 0===I?void 0:I.editingColor})});break;case td.Line:case td.Polyline:case td.Polygon:var J,H,Q,ee=l===td.Line,te=l===td.Polyline,ne=l===td.Polygon,re=h,ie=re.start,oe=re.end,ae=h,se=ae.points,ue=void 0===se?[]:se,le=ee?[ie,oe]:ue,he=[];if(this.hoverFeature)he=Rv(le,(function(e){var t=e.x,n=e.y;return{x:t+d,y:n-y}}));else if(au(this.hoverFeatureIndex)){var ce=parseInt("".concat(this.hoverFeatureIndex),10);zo(le,(function(e,n){var r=e.x,i=e.y;if(n===ce&&ce===t.hoverFeatureIndex)he.push({x:r+d,y:i-y});else if(n===ce&&ce!==t.hoverFeatureIndex){var o=le[n+1]||le[0],a=ad.MathUtil.getMiddlePoint({x:r,y:i},o);he.push({x:r,y:i}),he.push({x:a.x+d,y:a.y-y})}else he.push({x:r,y:i})}))}if(ee){var ve=he,fe=p(ve,2),de=fe[0],ye=fe[1];this.toUpdateShape=n(n({},h),{},{start:de,end:ye})}else this.toUpdateShape=n(n({},h),{},{points:he});this.map.overlayLayer.addActiveFeature(u),ee&&this.map.overlayLayer.addLineFeature(this.toUpdateShape,{clear:!1,style:n(n({},c),{},{strokeStyle:null===(J=this.map)||void 0===J?void 0:J.editingColor})}),te&&this.map.overlayLayer.addPolylineFeature(this.toUpdateShape,{clear:!1,style:n(n({},c),{},{strokeStyle:null===(H=this.map)||void 0===H?void 0:H.editingColor})}),ne&&this.map.overlayLayer.addPolygonFeature(this.toUpdateShape,{clear:!1,style:n(n({},c),{},{lineWidth:1,strokeStyle:null===(Q=this.map)||void 0===Q?void 0:Q.editingColor})});break}}},{key:"handleActiveFeatureEnd",value:function(e){this.dragging=!1,document.onmousemove=null,document.onmouseup=null,this.map.overlayLayer.removeAllFeatureActionText();var t=this.map.activeFeature;if(t&&this.map.overlayLayer.addActiveFeature(t),this.toUpdateShape&&t){var n=t.type;switch(n){case td.Point:case td.Circle:case td.Line:case td.Polyline:case td.Rect:case td.Polygon:this.map.eventsObServer.emit(Pv.FeatureUpdated,t,this.toUpdateShape);break}this.toUpdateShape=null}}},{key:"handleActiveFeatureElse",value:function(e){var t=this.map.activeFeature;if(t){var r=t.type,i=t.shape;switch(r){case td.Point:this.map.eventsObServer.emit(Pv.FeatureDeleted,t);break;case td.Polyline:case td.Polygon:var o=r===td.Polyline;td.Polygon;var a=o?2:3,s=i,u=s.points,l=void 0===u?[]:u;if(au(this.hoverFeatureIndex)&&l.length>a){var h=parseInt("".concat(this.hoverFeatureIndex),10);if(h===this.hoverFeatureIndex){var c=Av(l,(function(e,t){return t!==h})),v=n(n({},i),{},{points:c});this.map.eventsObServer.emit(Pv.FeatureUpdated,t,v)}}break}}}},{key:"getMouseEventPoint",value:function(e){var t=e.offsetX,n=e.offsetY,r={x:t,y:n},i=this.map.transformScreenToGlobal(r);return{screen:r,global:i}}},{key:"onMouseDown",value:function(e){var t=e.screenX,n=e.screenY;this.startPoint=this.getMouseEventPoint(e),this.startPageScreenPoint={x:t,y:n};var r=this.map.mode,i=this.dragging,o=this.hoverFeature||au(this.hoverFeatureIndex),a=!i&&!o;this.map.eventsObServer.emit(Pv.MouseDown,this.startPoint),!this.map.activeFeature||o?r!==Sv.Ban&&(r===Sv.Pan&&a?this.handleMapPanStart(e):r===Sv.MARKER&&a?this.handleMarkerStart(e):r===Sv.Point&&a?this.handlePointStart(e):r===Sv.Circle&&a?this.handleCircleStart(e):r===Sv.Line&&a?this.handleLineStart(e):r===Sv.Polyline&&a?this.handlePolylineStart(e):r===Sv.Rect&&a?this.handleRectStart(e):r===Sv.Polygon&&a?this.handlePolygonStart(e):r!==Sv.DrawMask&&r!==Sv.ClearMask||!a||this.handleMaskStart(e),o&&!i&&this.handleActiveFeatureStart(e)):this.map.eventsObServer.emit(Pv.FeatureUnselected,this.map.activeFeature,"cancel by click")}},{key:"onMouseMove",value:function(e){this.mouseMoveEvent=e;var t=this.getMouseEventPoint(e),n=t.screen,r=t.global,i=this.map.mode,o=this.dragging;if(this.map.eventsObServer.emit(Pv.MouseMove,{screen:n,global:r}),this.map.activeFeature||o||this.map.overlayLayer.removeAllFeatureActionText(),i!==Sv.Ban){if(i!==Sv.Pan||o)if(i!==Sv.MARKER||o)if(i!==Sv.Point||o)if(i!==Sv.Circle||o)if(i!==Sv.Line||o)if(i!==Sv.Polyline||o)if(i!==Sv.Rect||o)if(i!==Sv.Polygon||o){if(i===Sv.DrawMask){var a=tu(this.map.drawingStyle,"lineWidth",1);this.map.setCursor(Mv.DrawMask,{type:td.Circle,shape:{sr:a/2,cx:r.x,cy:r.y}})}else if(i===Sv.ClearMask){var s=tu(this.map.drawingStyle,"lineWidth",1);this.map.setCursor(Mv.ClearMask,{type:td.Circle,shape:{sr:s/2,cx:r.x,cy:r.y}})}}else this.map.setCursor(Dv.Crosshair),this.handlePolygonMove(e);else this.map.setCursor(Dv.Crosshair),this.setTip({text:"按下确定起点",position:r});else this.map.setCursor(Dv.Crosshair),this.handlePolylineMove(e);else this.map.setCursor(Dv.Crosshair),this.handleLineMove(e);else this.map.setCursor(Dv.Crosshair),this.setTip({text:"按下确定圆心",position:r});else this.map.setCursor(Dv.Crosshair),this.setTip({text:"点击绘制点",position:r});else this.map.setCursor(Dv.Crosshair);else this.map.setCursor(Dv.Grab);this.map.activeFeature&&!o&&this.setTip({text:"单击取消选中",position:r}),Nf([Sv.Point,Sv.Circle,Sv.Line,Sv.Polyline,Sv.Rect,Sv.Polygon],i)&&!o&&this.handleActiveFeatureCapture(e)}}},{key:"onMouseUp",value:function(e){this.map.eventsObServer.emit(Pv.MouseUp,this.getMouseEventPoint(e))}},{key:"onMouseClick",value:function(e){this.map.eventsObServer.emit(Pv.Click,this.getMouseEventPoint(e))}},{key:"onMouseDblClick",value:function(e){var t=this.map.mode;this.clearDownTimer();var n=this.dragging||this.tmpPointsStore.length;this.map.eventsObServer.emit(Pv.DblClick,this.getMouseEventPoint(e)),t!==Sv.Ban&&(t===Sv.Polyline&&n?this.handlePolylineEnd(e):t===Sv.Polygon&&n&&this.handlePolygonEnd(e),Nf([Sv.Point,Sv.Circle,Sv.Line,Sv.Polyline,Sv.Rect,Sv.Polygon],t)&&!n&&this.handleFeatureSelect(e))}},{key:"onMouseWheel",value:function(e){var t=this.map.mode;switch(t!==Sv.Ban&&e.preventDefault(),t){case Sv.Ban:break;case Sv.Pan:this.handleMapZoom(e);break;default:this.map.zoomWhenDrawing&&this.handleMapZoom(e);break}}},{key:"clearPanWhenDrawingTimer",value:function(){this.panWhenDrawingTimer&&(window.clearInterval(this.panWhenDrawingTimer),this.panWhenDrawingTimer=null)}},{key:"handlePanWhenDrawing",value:function(e){var t=this,n=ad.EventUtil.getMouseDirection(this.map.dom,e);this.clearPanWhenDrawingTimer();var r=10;this.map.panWhenDrawing&&this.tmpPointsStore.length&&(this.panWhenDrawingTimer=window.setInterval((function(){var e=t.map.getScale(),i=r/e,o=t.map.getCenter(),a=t.map.xAxis.direction===wv.Right,s=t.map.yAxis.direction===xv.Top,u=o;switch(n){case 0:u={x:o.x,y:s?o.y+i:o.y-i};break;case 1:u={x:a?o.x+i:o.x-i,y:o.y};break;case 2:u={x:o.x,y:s?o.y-i:o.y+i};break;case 3:u={x:a?o.x-i:o.x+i,y:o.y};break}t.map.setCenter(u)}),100))}},{key:"onMouseOut",value:function(e){if(e.preventDefault(),this.map.tipLayer.removeAllFeatureActionText(),this.map.cursorLayer.removeAllFeatureActionText(),e.toElement){var t=e.toElement.getAttribute("data-type");if(t===id.Marker)return}this.handlePanWhenDrawing(e),this.map.eventsObServer.emit(Pv.MouseOut,this.getMouseEventPoint(e))}},{key:"onMouseOver",value:function(e){e.preventDefault(),this.map.tipLayer.removeAllFeatureActionText(),this.clearPanWhenDrawingTimer(),this.map.eventsObServer.emit(Pv.MouseOver,this.getMouseEventPoint(e))}},{key:"revokeTmpPointsStore",value:function(){if(this.tmpPointsStore.length){this.tmpPointsStore.pop();var e=this.mouseMoveEvent;e&&this.onMouseMove(e)}}},{key:"setTip",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.map.drawingTip?this.map.tipLayer.addText(e,t):this.map.tipLayer.removeAllFeatureActionText()}},{key:"reset",value:function(){this.tmpPointsStore=[],this.map.overlayLayer.removeAllFeatureActionText(),this.map.tipLayer.removeAllFeatureActionText()}},{key:"refresh",value:function(){y(u(i.prototype),"refresh",this).call(this)}}]),i}(Jf),ud=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};r(this,e),this.id=t,this.type=n,this.props=i,this.style=Gi({},e.defaultStyle,o)}return o(e,[{key:"onAdd",value:function(e){this.layer=e,this.refresh()}},{key:"onRemove",value:function(){var e,t,n=null===(e=this.layer)||void 0===e||null===(t=e.map)||void 0===t?void 0:t.activeFeature;n&&n.id===this.id&&this.layer.map.setActiveFeature(null)}},{key:"getBounds",value:function(){return{x:0,y:0,width:0,height:0}}},{key:"captureWithPoint",value:function(e){return!1}},{key:"updateShape",value:function(e){var t,n,r;this.shape=e,null===(t=this.layer)||void 0===t||t.refresh();var i=null===(n=this.layer)||void 0===n||null===(r=n.map)||void 0===r?void 0:r.activeFeature;i&&i.id===this.id&&this.layer.map.setActiveFeature(this)}},{key:"setStyle",value:function(e,t){var n,r=t.refresh,i=void 0===r||r;this.style=e,i&&(null===(n=this.layer)||void 0===n||n.refresh())}},{key:"refresh",value:function(){}},{key:"printInfo",value:function(){}}]),e}();a(ud,"defaultStyle",{opacity:1,fillStyle:"rgba(255, 0, 0, 0)",lineWidth:1,strokeStyle:"#000"});var ld=function(e){s(n,e);var t=f(n);function n(e,i){var o,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=arguments.length>4?arguments[4]:void 0;return r(this,n),o=t.call(this,e,td.Point,s,u),a(c(o),"option",{}),o.shape=i,o.option=Gi({},n.defaultOption,l||{}),o}return o(n,[{key:"captureWithPoint",value:function(e){var t,n,r=this.shape,i=r.x,o=r.y,a=r.r,s=r.sr,u=null===(t=this.layer)||void 0===t||null===(n=t.map)||void 0===n?void 0:n.getScale(),l=u?3/u:0,h=au(a)?a+l:au(s)?s/u+l:l;return ad.MathUtil.pointInPoint(e,{x:i,y:o},{tolerance:h})}},{key:"refresh",value:function(){var e=this.shape,t=e.x,n=e.y,r=e.r,i=e.sr,o=this.layer.map.transformGlobalToScreen({x:t,y:n}),a=o.x,s=o.y,u=Hf.dpr,l=this.layer.map.getScale(),h=au(r)?r*l:au(i)?i:2,c=a*u,v=s*u,f=h*u;if(Qf.drawPoint(this.layer.canvasContext,{x:c,y:v,r:f},this.style,{}),this.option.active){var d=c-f-2,y=v-f-2,p=2*f+4,m=2*f+4,g=d+p,b=y,w=g,x=b+m,k=d,S=x;Qf.drawLine(this.layer.canvasContext,{start:{x:d,y:y},end:{x:w,y:x}},{strokeStyle:"#fff"}),Qf.drawLine(this.layer.canvasContext,{start:{x:g,y:b},end:{x:k,y:S}},{strokeStyle:"#fff"}),Qf.drawRect(this.layer.canvasContext,{x:d,y:y,width:p,height:m},{strokeStyle:"#666"})}}}]),n}(ud);a(ld,"defaultOption",{active:!1});var hd=function(e){s(i,e);var t=f(i);function i(e,n){var o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return r(this,i),o=t.call(this,e,td.Line,a,s),o.shape=n,o}return o(i,[{key:"captureWithPoint",value:function(e){var t,n,r=this.shape,i=r.start,o=r.end,a=r.width,s=null===(t=this.layer)||void 0===t||null===(n=t.map)||void 0===n?void 0:n.getScale(),u=s?3/s:0,l=au(a)?a/2+u:u;return ad.MathUtil.pointInPolyline(e,[i,o],{tolerance:l})}},{key:"refresh",value:function(){var e=this.shape,t=e.start,r=e.end,i=e.width,o=this.layer.map.transformGlobalToScreen(t),a=o.x,s=o.y,u=this.layer.map.transformGlobalToScreen(r),l=u.x,h=u.y,c=Hf.dpr,v=this.layer.map.getScale(),f=(i||0)*v;Qf.drawLine(this.layer.canvasContext,n({start:{x:a*c,y:s*c},end:{x:l*c,y:h*c}},au(i)?{width:f*c}:{}),this.style,{})}}]),i}(ud),cd=function(e){s(i,e);var t=f(i);function i(e,n){var o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return r(this,i),o=t.call(this,e,td.Polyline,a,s),o.shape=n,o}return o(i,[{key:"captureWithPoint",value:function(e){var t,n,r=this.shape,i=r.points,o=void 0===i?[]:i,a=r.width,s=null===(t=this.layer)||void 0===t||null===(n=t.map)||void 0===n?void 0:n.getScale(),u=s?3/s:0,l=au(a)?a/2+u:u;return ad.MathUtil.pointInPolyline(e,o,{tolerance:l})}},{key:"refresh",value:function(){var e=this,t=Hf.dpr,r=this.layer.map.getScale();Qf.drawPolyline(this.layer.canvasContext,this.shape,this.style,{format:function(i){var o=i.points,a=i.width;return n({points:Rv(o,(function(n){var r=e.layer.map.transformGlobalToScreen(n),i=r.x,o=r.y;return{x:i*t,y:o*t}}))},au(a)?{width:a*r*t}:{})}})}}]),i}(ud),vd=function(e){s(n,e);var t=f(n);function n(e,i){var o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return r(this,n),o=t.call(this,e,td.Rect,a,s),o.shape=i,o}return o(n,[{key:"captureWithPoint",value:function(e){var t=this.getPoints();return ad.MathUtil.pointInPolygon(e,t)}},{key:"getPoints",value:function(){var e,t,n,r,i=(null===(e=this.layer)||void 0===e||null===(t=e.map)||void 0===t?void 0:t.xAxis.direction)===wv.Left,o=(null===(n=this.layer)||void 0===n||null===(r=n.map)||void 0===r?void 0:r.yAxis.direction)===xv.Bottom,a=this.shape,s=a.x,u=a.y,l=a.width,h=a.height,c=i?s-l:s+l,v=o?u+h:u-h;return[{x:s,y:u},{x:c,y:u},{x:c,y:v},{x:s,y:v}]}},{key:"refresh",value:function(){var e=this,t=Hf.dpr,n=this.layer.map.getScale();Qf.drawRect(this.layer.canvasContext,this.shape,this.style,{format:function(r){var i=r.x,o=r.y,a=r.width,s=r.height,u=e.layer.map.transformGlobalToScreen({x:i,y:o}),l=u.x,h=u.y,c=a*n,v=s*n;return{x:l*t,y:h*t,width:c*t,height:v*t}}})}}]),n}(ud),fd=function(e){s(n,e);var t=f(n);function n(e,i){var o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return r(this,n),o=t.call(this,e,td.Polygon,a,s),o.shape=i,o}return o(n,[{key:"captureWithPoint",value:function(e){var t=this.shape,n=t.points,r=void 0===n?[]:n;return ad.MathUtil.pointInPolygon(e,r)}},{key:"refresh",value:function(){var e=this,t=this.shape,n=t.points;t.inner;var r=Hf.dpr;Qf.drawPolygon(this.layer.canvasContext,n,this.style,{format:function(t){var n=e.layer.map.transformGlobalToScreen(t),i=n.x,o=n.y;return{x:i*r,y:o*r}}})}}]),n}(ud),dd=function(e){s(n,e);var t=f(n);function n(e,i){var o,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=arguments.length>4?arguments[4]:void 0;return r(this,n),o=t.call(this,e,td.Circle,s,u),a(c(o),"option",{}),o.shape=i,o.option=Gi({},n.defaultOption,l||{}),o}return o(n,[{key:"getSubType",value:function(){var e=this.shape,t=e.r,n=e.sr;return au(t)?nd.Global:au(n)?nd.Screen:void 0}},{key:"captureWithPoint",value:function(e){var t,n,r=this.getSubType()===nd.Global,i=this.getSubType()===nd.Screen,o=this.shape,a=o.cx,s=o.cy,u=o.r,l=o.sr,h=null===(t=this.layer)||void 0===t||null===(n=t.map)||void 0===n?void 0:n.getScale(),c=h?3/h:0,v=r?u+c:i?l/h+c:c;return ad.MathUtil.pointInPoint(e,{x:a,y:s},{tolerance:v})}},{key:"getEdgePoints",value:function(){var e,t,n,r,i=this.getSubType()===nd.Global,o=this.getSubType()===nd.Screen,a=(null===(e=this.layer)||void 0===e||null===(t=e.map)||void 0===t?void 0:t.xAxis.direction)===wv.Left,s=(null===(n=this.layer)||void 0===n||null===(r=n.map)||void 0===r?void 0:r.yAxis.direction)===xv.Bottom,u=this.shape,l=u.cx,h=u.cy,c=u.r,v=u.sr,f=i?c:o?v:0,d=Math.sqrt(f*f/2),y=a?-d:d,p=s?-d:d;if(i)return[{x:l-y,y:h+p},{x:l+y,y:h+p},{x:l+y,y:h-p},{x:l-y,y:h-p}];if(o){var m,g,b=null===(m=this.layer)||void 0===m||null===(g=m.map)||void 0===g?void 0:g.getScale();if(!b)return console.error("circle getEdgePoints error: no added to layer or map"),[];var w=d/b,x=a?-w:w,k=s?-w:w;return[{x:l-x,y:h+k},{x:l+x,y:h+k},{x:l+x,y:h-k},{x:l-x,y:h-k}]}return console.error("circle getEdgePoints error: no valid radius"),[]}},{key:"refresh",value:function(){var e=this,t=this.getSubType()===nd.Global,n=Hf.dpr,r=this.layer.map.getScale();if(Qf.drawCircle(this.layer.canvasContext,this.shape,this.style,{format:function(i){var o=i.cx,a=i.cy,s=i.r,u=i.sr,l=t?s*r:au(u)?u:2,h=e.layer.map.transformGlobalToScreen({x:o,y:a}),c=h.x,v=h.y;return{cx:c*n,cy:v*n,r:l*n}}}),this.option.active){var i=this.getEdgePoints();zo(i,(function(t){var r=t.x,i=t.y;Qf.drawCircle(e.layer.canvasContext,{sr:3.5,cx:r,cy:i},{strokeStyle:"#666",fillStyle:"#fff",stroke:!0,fill:!0,lineWidth:1},{format:function(t){var r=t.cx,i=t.cy,o=t.sr,a=o,s=e.layer.map.transformGlobalToScreen({x:r,y:i}),u=s.x,l=s.y;return{cx:u*n,cy:l*n,r:a*n}}})}))}}}]),n}(ud);a(dd,"defaultOption",{active:!1});var yd,pd=function(e){s(i,e);var t=f(i);function i(e,n,o){var s,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return r(this,i),s=t.call(this,e,Kf.Draw,u,l),a(c(s),"category",""),s.shape=o,s.category=n,s}return o(i,[{key:"refresh",value:function(){var e=this,t=Hf.dpr,r=this.layer.map.getScale(),i=n(n({},this.style||{}),{},{lineCap:"round",lineJoin:"round"});Qf.drawPolyline(this.layer.canvasContext,this.shape,i,{format:function(i){var o=i.points,a=i.width;return n({points:Rv(o,(function(n){var r=e.layer.map.transformGlobalToScreen(n),i=r.x,o=r.y;return{x:i*t,y:o*t}}))},au(a)?{width:a*r*t}:{})}})}}]),i}(Yf);(function(e){e["Text"]="TEXT"})(yd||(yd={}));var md=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};r(this,e),this.id=t,this.type=yd.Text,this.props=i,this.textInfo=Gi({},e.defaultTextInfo,n),this.style=Gi({},e.defaultStyle,o)}return o(e,[{key:"onAdd",value:function(e){this.layer=e,this.refresh()}},{key:"onRemove",value:function(){}},{key:"updatePosition",value:function(e){var t,r=this.textInfo;this.textInfo=n(n({},r),{},{position:e}),null===(t=this.layer)||void 0===t||t.refresh()}},{key:"refresh",value:function(){var e=this,t=this.textInfo,r=Hf.dpr;Qf.drawText(this.layer.canvasContext,t,this.style,{format:function(t){var i=t.position,o=t.offset,a=e.layer.map.transformGlobalToScreen(i),s=a.x,u=a.y,l=o.x,h=o.y;return n(n({},t),{},{position:{x:s*r,y:u*r},offset:{x:l*r,y:h*r}})}})}},{key:"printInfo",value:function(){}}]),e}();a(md,"defaultStyle",{opacity:1,strokeStyle:"#FF0000",background:!0,fontColor:"#FFFFFF",fillStyle:"#FF0000",font:"normal 12px Arial",textAlign:"left",textBaseline:"bottom"}),a(md,"defaultTextInfo",{text:"",position:{x:0,y:0},offset:{x:0,y:0}});var gd=function(e){s(i,e);var t=f(i);function i(e){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(this,i),n=t.call(this,e,ed.Overlay,o,s),a(c(n),"featureActionTexts",[]),a(c(n),"defaultActiveFeatureStyle",{strokeStyle:"#FF0000",fillStyle:"#FF0000",lineWidth:1}),n}return o(i,[{key:"addFeatureActionText",value:function(e,t){var n=t||{},r=n.clear,i=void 0!==r&&r;i&&this.removeAllFeatureActionText(),e.onAdd(this),this.featureActionTexts.push(e)}},{key:"addPointFeature",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.style,r=t.clear,i=void 0===r||r,o=t.active,a=void 0!==o&&o,s=new ld("".concat(+new Date),e,{},n||this.map.drawingStyle,{active:a});this.addFeatureActionText(s,{clear:i})}},{key:"addLineFeature",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.style,r=t.clear,i=void 0===r||r,o=new hd("".concat(+new Date),e,{},n||this.map.drawingStyle);this.addFeatureActionText(o,{clear:i});var a=e,s=a.start,u=a.end;this.addDrawingPoints([s,u])}},{key:"addPolylineFeature",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.style,r=t.clear,i=void 0===r||r,o=new cd("".concat(+new Date),e,{},n||this.map.drawingStyle);this.addFeatureActionText(o,{clear:i}),this.addDrawingPoints(e.points)}},{key:"addRectFeature",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.style,r=t.clear,i=void 0===r||r,o=new vd("".concat(+new Date),e,{},n||this.map.drawingStyle);this.addFeatureActionText(o,{clear:i});var a=o.getPoints();this.addDrawingPoints(a)}},{key:"addPolygonFeature",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.style,r=t.clear,i=void 0===r||r,o=new fd("".concat(+new Date),e,{},n||this.map.drawingStyle);this.addFeatureActionText(o,{clear:i}),this.addDrawingPoints(e.points)}},{key:"addCircleFeature",value:function(e,t){var n=t||{},r=n.clear,i=void 0===r||r,o=n.style,a=n.active,s=void 0!==a&&a,u=new dd("".concat(+new Date),e,{},o||this.map.drawingStyle,{active:s});this.addFeatureActionText(u,{clear:i})}},{key:"addDrawAction",value:function(e){var t=new pd("".concat(+new Date),"drawAction",e,{},this.map.drawingStyle);this.addFeatureActionText(t,{clear:!0})}},{key:"addText",value:function(e,t){var r=t||{},i=r.clear,o=void 0===i||i,a=new md("".concat(+new Date),n(n({},e),{},{offset:{x:5,y:-5}}),{},{fillStyle:"#FFFFFF",strokeStyle:"#D2691E",background:!0,globalAlpha:1,fontColor:"#333",font:"normal 10px Arial",textBaseline:"top"});this.addFeatureActionText(a,{clear:o})}},{key:"addActiveFeature",value:function(e){if(e){var t=this.defaultActiveFeatureStyle,n=e.type,r=e.shape;switch(n){case td.Point:this.addPointFeature(r,{style:t,active:!0});break;case td.Line:this.addLineFeature(r,{style:t});break;case td.Polyline:this.addPolylineFeature(r,{style:t}),this.addActiveMiddlePoints(r.points,{withClose:!1});break;case td.Rect:this.addRectFeature(r,{style:t});break;case td.Polygon:this.addPolygonFeature(r,{style:t}),this.addActiveMiddlePoints(r.points,{withClose:!0});break;case td.Circle:this.addCircleFeature(r,{style:t,active:!0});break}}else this.removeAllFeatureActionText()}},{key:"addActiveMiddlePoints",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.withClose,i=void 0===r||r;zo(e,(function(n,r){var o=i?e[r+1]||e[0]:e[r+1];if(o){var a=ad.MathUtil.getMiddlePoint(n,o);t.addDrawingPoint(a,{strokeStyle:"#228B22",withAddIcon:!0})}}))}},{key:"addDrawingPoints",value:function(e){var t=this;zo(e,(function(e){t.addDrawingPoint(e)}))}},{key:"addDrawingPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.strokeStyle,r=void 0===n?"#666":n,i=t.fillStyle,o=void 0===i?"#fff":i,a=t.withAddIcon,s=void 0!==a&&a,u=t.iconColor,l=void 0===u?"#228B22":u,h=e.x,c=e.y;this.addCircleFeature({sr:3.5,cx:h,cy:c},{clear:!1,style:{strokeStyle:r,fillStyle:o,stroke:!0,fill:!0,lineWidth:1}}),s&&this.addCircleFeature({sr:1.25,cx:h,cy:c},{clear:!1,style:{fillStyle:l,stroke:!1,fill:!0}})}},{key:"removeAllFeatureActionText",value:function(){this.featureActionTexts=[],this.clear()}},{key:"refresh",value:function(){y(u(i.prototype),"refresh",this).call(this),zo(this.featureActionTexts,(function(e){return e.refresh()}))}}]),i}(Hf),bd=dv,wd=_n,xd=ji;function kd(e){return function(t,n,r){var i=Object(t);if(!wd(t)){var o=bd(n);t=xd(t),n=function(e){return o(i[e],e,i)}}var a=e(t,n,r);return a>-1?i[o?t[a]:a]:void 0}}var Sd=kd,Pd=Gv,Dd=dv,Md=Cf,Ad=Math.max;function Cd(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:Md(n);return i<0&&(i=Ad(r+i,0)),Pd(e,Dd(t),i)}var Od=Cd,Td=Sd,jd=Od,Id=Td(jd),Ld=Id,Fd=function(e){s(n,e);var t=f(n);function n(e){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(this,n),i=t.call(this,e,ed.Marker,o,s),a(c(i),"markers",[]),i}return o(n,[{key:"addMarker",value:function(e,t){e.onAdd(this),this.markers.push(e)}},{key:"removeMarkerById",value:function(e){var t=Av(this.markers,(function(t){var n=t.id;return n!==e||(t.onRemove(),!1)}));this.markers=t,this.refresh()}},{key:"getMarkerById",value:function(e){return Ld(this.markers,(function(t){var n=t.id;return n===e}))}},{key:"getAllMarkers",value:function(){return this.markers}},{key:"removeAllMarkers",value:function(){var e=Av(this.markers,(function(e){return e.onRemove(),!1}));this.markers=e,this.refresh()}},{key:"resize",value:function(){this.dom.style.width="0px",this.dom.style.height="0px"}},{key:"refresh",value:function(){y(u(n.prototype),"refresh",this).call(this),zo(this.markers,(function(e){return e.refresh()}))}}]),n}(Jf),Ed=function(){function e(t,n){var i=this;r(this,e),a(this,"controls",[]),a(this,"layers",[]),a(this,"drawingStyle",{}),a(this,"drawingTip",!0),a(this,"editingColor","#FF0000"),a(this,"activeFeature",null),a(this,"events",{on:function(e,t){i.eventsObServer.on(e,t)}}),this.wrapperDomId=t,this.wrapperDom=document.getElementById(t),this.createMainDom(),this.mapOptions=Gi({},e.defaultMapOptions,n),this.zoom=this.mapOptions.zoom,this.center=this.mapOptions.center,this.mode=this.mapOptions.mode,this.refreshDelayWhenZooming=this.mapOptions.refreshDelayWhenZooming,this.zoomWhenDrawing=this.mapOptions.zoomWhenDrawing,this.panWhenDrawing=this.mapOptions.panWhenDrawing,this.xAxis=this.mapOptions.xAxis,this.yAxis=this.mapOptions.yAxis,this.size=this.mapOptions.size||{width:tu(this.dom,"clientWidth",0),height:tu(this.dom,"clientHeight",0)},this.setDomStyle(),this.createSubDoms(),this.addOverlayLayer(),this.addTipLayer(),this.addCursorLayer(),this.addEventLayer(),this.addMarkerLayer(),this.eventsObServer=new N.EventEmitter,this.registerHotkey()}return o(e,[{key:"setDomStyle",value:function(){this.dom.ondragstart=function(e){e.preventDefault(),e.stopPropagation()},this.dom.oncontextmenu=function(e){e.preventDefault(),e.stopPropagation()}}},{key:"setMode",value:function(e){this.mode=e,this.eventLayer.reset(),this.activeFeature&&this.eventsObServer.emit(Pv.FeatureUnselected,this.activeFeature,"cancel by switch mode")}},{key:"setDrawingStyle",value:function(e){this.drawingStyle=e}},{key:"setEditingColor",value:function(e){this.editingColor=e}},{key:"enableDrawingTip",value:function(){this.drawingTip=!0}},{key:"disableDrawingTip",value:function(){this.drawingTip=!1}},{key:"getSize",value:function(){return this.size}},{key:"getScale",value:function(e){var t=au(e)?e:this.zoom,n=1e6,r=this.getSize(),i=r.width,o=parseInt(i*n/t+"",10)/n;return o}},{key:"setCenter",value:function(e){return this.center=e,this.refresh(),this.triggerBoundsChanged(),this}},{key:"getCenter",value:function(){return this.center}},{key:"getScreenCenter",value:function(){var e=this.getSize(),t=e.width,n=e.height;return{x:t/2,y:n/2}}},{key:"getBounds",value:function(e){var t=this.getSize(),n=t.width,r=t.height,i=this.transformScreenToGlobal({x:0,y:0}),o=i.x,a=i.y,s=this.transformScreenToGlobal({x:n,y:r}),u=s.x,l=s.y;return{x:o,y:a,width:u-o,height:a-l}}},{key:"enableZoomWhenDrawing",value:function(){this.zoomWhenDrawing=!0}},{key:"disableZoomWhenDrawing",value:function(){this.zoomWhenDrawing=!1}},{key:"enablePanWhenDrawing",value:function(){this.panWhenDrawing=!0}},{key:"disablePanWhenDrawing",value:function(){this.panWhenDrawing=!1}},{key:"centerAndZoom",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.refreshDelay,r=void 0!==n&&n,i=e.center,o=e.zoom;return i&&(this.center=i),au(o)&&(this.zoom=o),this.refresh(r&&this.refreshDelayWhenZooming),this.triggerBoundsChanged(),this}},{key:"zoomTo",value:function(e){this.zoom=e,this.refresh(),this.triggerBoundsChanged()}},{key:"zoomIn",value:function(){this.zoom=this.zoom/2,this.refresh(),this.triggerBoundsChanged()}},{key:"zoomOut",value:function(){this.zoom=2*this.zoom,this.refresh(),this.triggerBoundsChanged()}},{key:"addControl",value:function(e){e.onAdd(this),this.controls.push(e)}},{key:"removeControlById",value:function(e){var t=Av(this.controls,(function(t){var n=t.id;return n!==e||(t.onRemove(),!1)}));this.controls=t}},{key:"addLayer",value:function(e){var t=e.dom;this.layerDom.appendChild(t),e.onAdd(this),this.layers.push(e)}},{key:"removeLayerById",value:function(e){var t=Av(this.layers,(function(t){var n=t.id;return n!==e||(t.onRemove(),!1)}));this.layers=t,this.refresh()}},{key:"removeAllLayers",value:function(){var e=Av(this.layers,(function(e){return e.onRemove(),!1}));this.layers=e,this.refresh()}},{key:"getLayers",value:function(){return this.layers}},{key:"triggerBoundsChanged",value:function(){var e=this;this.boundsChangedTimer&&(window.clearTimeout(this.boundsChangedTimer),this.boundsChangedTimer=null),this.boundsChangedTimer=window.setTimeout((function(){e.eventsObServer.emit(Pv.BoundsChanged)}),666),this.overlayLayer.refresh()}},{key:"refresh",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];zo(this.layers,(function(t){return t.refresh(e)})),this.markerLayer.refresh()}},{key:"resize",value:function(e){this.size=e||{width:tu(this.dom,"clientWidth",0),height:tu(this.dom,"clientHeight",0)},this.setLayerDomSize(),this.setPlatformDomSize(),zo(this.layers,(function(e){return e.resizeAndRefresh()})),this.markerLayer.resizeAndRefresh(),this.overlayLayer.resizeAndRefresh(),this.tipLayer.resizeAndRefresh(),this.eventLayer.resizeAndRefresh()}},{key:"setActiveFeature",value:function(e){this.activeFeature=e,this.overlayLayer.addActiveFeature(e);var t=this.eventLayer.mouseMoveEvent;t&&this.eventLayer.onMouseMove(t)}},{key:"getActiveFeature",value:function(){return this.activeFeature}},{key:"removeDrawingPoints",value:function(){this.eventLayer.revokeTmpPointsStore()}},{key:"getTargetFeatureWithPoint",value:function(e){var t=this.getLayers(),n=[];zo(t,(function(t){if(t.type===ed.Feature){var r=t.getTargetFeatureWithPoint(e);if(r)return n.push(r),!1}}));var r=tu(n,"[0]",null);return r}},{key:"transformScreenToGlobal",value:function(e,t){var n=t||{},r=n.basePoint,i=n.zoom,o=this.getScale(i),a=this.getScreenCenter(),s=a.x,u=a.y,l=e.x,h=e.y,c=tu(r,"screen.x",s),v=tu(r,"screen.y",u),f=tu(r,"global",this.center),d=f.x,y=f.y,p=l-c,m=h-v,g=this.xAxis.direction===wv.Right,b=this.yAxis.direction===xv.Top,w=g?d+p/o:d-p/o,x=b?y-m/o:y+m/o;return{x:w,y:x}}},{key:"transformGlobalToScreen",value:function(e,t){var n=t||{},r=n.basePoint,i=n.zoom,o=this.getScale(i),a=this.getScreenCenter(),s=a.x,u=a.y,l=e.x,h=e.y,c=tu(r,"screen.x",s),v=tu(r,"screen.y",u),f=tu(r,"global",this.center),d=f.x,y=f.y,p=l-d,m=h-y,g=this.xAxis.direction===wv.Right,b=this.yAxis.direction===xv.Top,w=g?c+p*o:c-p*o,x=b?v-m*o:v+m*o;return{x:w,y:x}}},{key:"createMainDom",value:function(){this.domId="main-wrapper-".concat(ho()),this.dom=document.createElement("div"),this.dom.setAttribute("id",this.domId),this.dom.style.position="absolute",this.dom.style.left="0",this.dom.style.top="0",this.dom.style.right="0",this.dom.style.bottom="0",this.wrapperDom.appendChild(this.dom)}},{key:"createSubDoms",value:function(){this.setLayerDom(),this.setPlatformDom(),this.setLayerDom2(),this.setControlDom()}},{key:"setLayerDom",value:function(){this.layerDomId="layer-wrapper-".concat(ho()),this.layerDom=document.createElement("div"),this.layerDom.setAttribute("id",this.layerDomId),this.layerDom.style.position="absolute",this.layerDom.style.left="0",this.layerDom.style.top="0",this.layerDom.style.zIndex="1",this.setLayerDomSize(),this.dom.appendChild(this.layerDom)}},{key:"setLayerDomSize",value:function(){var e=this.getSize(),t=e.width,n=e.height;this.layerDom.style.width="".concat(t,"px"),this.layerDom.style.height="".concat(n,"px")}},{key:"setPlatformDom",value:function(){this.platformDomId="platform-wrapper-".concat(ho()),this.platformDom=document.createElement("div"),this.platformDom.setAttribute("id",this.platformDomId),this.platformDom.style.position="absolute",this.platformDom.style.left="0",this.platformDom.style.top="0",this.platformDom.style.zIndex="5",this.setPlatformDomSize(),this.dom.appendChild(this.platformDom)}},{key:"setPlatformDomSize",value:function(){var e=this.getSize(),t=e.width,n=e.height;this.platformDom.style.width="".concat(t,"px"),this.platformDom.style.height="".concat(n,"px")}},{key:"setLayerDom2",value:function(){this.layerDom2Id="layer2-wrapper-".concat(ho()),this.layerDom2=document.createElement("div"),this.layerDom2.setAttribute("id",this.layerDom2Id),this.layerDom2.style.position="absolute",this.layerDom2.style.left="0",this.layerDom2.style.right="0",this.layerDom2.style.width="0",this.layerDom2.style.height="0",this.layerDom2.style.zIndex="10",this.dom.appendChild(this.layerDom2)}},{key:"setControlDom",value:function(){this.controlDomId="control-wrapper-".concat(ho()),this.controlDom=document.createElement("div"),this.controlDom.setAttribute("id",this.controlDomId),this.controlDom.style.position="absolute",this.controlDom.style.left="0",this.controlDom.style.right="0",this.controlDom.style.width="0",this.controlDom.style.height="0",this.controlDom.style.zIndex="15",this.dom.appendChild(this.controlDom)}},{key:"addEventLayer",value:function(){this.eventLayer=new sd("event-".concat(ho()),{},{zIndex:5}),this.platformDom.appendChild(this.eventLayer.dom),this.eventLayer.onAdd(this)}},{key:"addOverlayLayer",value:function(){this.overlayLayer=new gd("overlay-".concat(ho()),{},{zIndex:1}),this.platformDom.appendChild(this.overlayLayer.dom),this.overlayLayer.onAdd(this)}},{key:"addTipLayer",value:function(){this.tipLayer=new gd("tip-".concat(ho()),{},{zIndex:2}),this.platformDom.appendChild(this.tipLayer.dom),this.tipLayer.onAdd(this)}},{key:"addCursorLayer",value:function(){this.cursorLayer=new gd("cursor-".concat(ho()),{},{zIndex:3}),this.platformDom.appendChild(this.cursorLayer.dom),this.cursorLayer.onAdd(this)}},{key:"addMarkerLayer",value:function(){this.markerLayer=new Fd("marker-".concat(ho()),{},{zIndex:10}),this.layerDom2.appendChild(this.markerLayer.dom),this.markerLayer.onAdd(this)}},{key:"registerHotkey",value:function(){var e=this;ge("ctrl+z",(function(t,n){e.removeDrawingPoints()}))}},{key:"setCursor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.cursorLayer.removeAllFeatureActionText(),this.platformDom.style.cursor=e,this.setCursorFeature(t),this}},{key:"setUrlCursor",value:function(e){return this}},{key:"setCursorFeature",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.type,n=e.shape;t===td.Circle&&this.cursorLayer.addCircleFeature(n,{style:{lineWidth:1,strokeStyle:"#aaa",fillStyle:"#ffffffb3",stroke:!0,fill:!0}})}},{key:"onDrag",value:function(e,t){this.layerDom.style.left="".concat(e,"px"),this.layerDom.style.top="".concat(t,"px"),this.layerDom2.style.left="".concat(e,"px"),this.layerDom2.style.top="".concat(t,"px")}},{key:"onZoom",value:function(e){this.dom.style.transform="scale(".concat(e,")")}},{key:"reset",value:function(){return this.layerDom.style.left="0",this.layerDom.style.top="0",this.layerDom2.style.left="0",this.layerDom2.style.top="0",this}},{key:"destroy",value:function(){this.dom.remove()}},{key:"printInfo",value:function(){}}]),e}();a(Ed,"defaultMapOptions",{center:{x:0,y:0},zoom:1e3,mode:Sv.Pan,size:null,refreshDelayWhenZooming:!0,zoomWhenDrawing:!1,panWhenDrawing:!1,xAxis:{direction:wv.Right},yAxis:{direction:xv.Bottom}});var _d=function(e){s(n,e);var t=f(n);function n(e,i){var o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return r(this,n),o=t.call(this,e,ed.Image,a,s),o.imageInfo=Gi({},n.defaultImageInfo,i),o.position=o.imageInfo.position,o.grid=o.imageInfo.grid,o.updateImage(),o}return o(n,[{key:"updateImageInfo",value:function(e){this.imageInfo=Gi({},this.imageInfo,e),e.position&&(this.position=this.imageInfo.position),e.src&&this.updateImage(),this.refresh()}},{key:"updateImage",value:function(){var e=this;this.imageInfo.src&&(this.image=new Image,this.image.src=this.imageInfo.src,this.image.onload=function(){e.map&&e.refresh()})}},{key:"updateGrid",value:function(e){this.grid=e,this.refresh()}},{key:"onAdd",value:function(e){y(u(n.prototype),"onAdd",this).call(this,e),this.refresh()}},{key:"drawImage",value:function(){var e=this.map.transformGlobalToScreen(this.position),t=e.x,n=e.y,r=Hf.dpr,i=this.map.getScale(),o=this.imageInfo,a=o.width,s=o.height,u=a*i,l=s*i;Qf.drawImage(this.canvasContext,{image:this.image,x:t*r,y:n*r,width:u*r,height:l*r},{})}},{key:"drawGrid",value:function(){var e=this,t=this.imageInfo,n=t.width,r=t.height,i=this.position,o=i.x,a=i.y,s=Hf.dpr,u=this.map.xAxis.direction===wv.Right,l=this.map.yAxis.direction===xv.Top,h=tu(this.grid,"columns",[]),c=tu(this.grid,"rows",[]),v=h.length,f=n/(v+1);zo(h,(function(t,n){var i=t||{},h=i.color,c=void 0===h?"#333":h,v=i.width,d=void 0===v?1:v,y=(n+1)*f,p=u?o+y:o-y,m=a,g=l?a-r:a+r,b=e.map.transformGlobalToScreen({x:p,y:m}),w=e.map.transformGlobalToScreen({x:p,y:g});Qf.drawLine(e.canvasContext,{start:{x:b.x*s,y:b.y*s},end:{x:w.x*s,y:w.y*s}},{strokeStyle:c,lineWidth:d,globalAlpha:.8})}));var d=c.length,y=r/(d+1);zo(c,(function(t,r){var i=t||{},h=i.color,c=void 0===h?"#333":h,v=i.width,f=void 0===v?1:v,d=(r+1)*y,p=l?a-d:a+d,m=o,g=u?o+n:o-n,b=e.map.transformGlobalToScreen({x:m,y:p}),w=e.map.transformGlobalToScreen({x:g,y:p});Qf.drawLine(e.canvasContext,{start:{x:b.x*s,y:b.y*s},end:{x:w.x*s,y:w.y*s}},{strokeStyle:c,lineWidth:f,globalAlpha:.8})}))}},{key:"refresh",value:function(){y(u(n.prototype),"refresh",this).call(this),this.drawImage(),this.drawGrid()}}]),n}(Hf);a(_d,"defaultImageInfo",{src:"",width:0,height:0,position:{x:0,y:0},grid:{columns:[],rows:[]}});var Rd=function(e){s(n,e);var t=f(n);function n(e){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(this,n),i=t.call(this,e,ed.Feature,o,s),a(c(i),"features",[]),i}return o(n,[{key:"addFeature",value:function(e,t){var n=t||{},r=n.clear,i=void 0!==r&&r;i&&(this.features=[],this.clear()),e.onAdd(this),this.features.push(e)}},{key:"removeFeatureById",value:function(e){var t=Av(this.features,(function(t){var n=t.id;return n!==e||(t.onRemove(),!1)}));this.features=t,this.refresh()}},{key:"getFeatureById",value:function(e){return Ld(this.features,(function(t){var n=t.id;return n===e}))}},{key:"getAllFeatures",value:function(){return this.features}},{key:"removeAllFeatures",value:function(){var e=Av(this.features,(function(e){return e.onRemove(),!1}));this.features=e,this.refresh()}},{key:"getTargetFeatureWithPoint",value:function(e){var t=[];return zo(this.features,(function(n){var r=n.captureWithPoint(e);if(r)return t.push(n),!1})),tu(t,"[0]",null)}},{key:"refresh",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.refreshDelayTimer&&(window.clearTimeout(this.refreshDelayTimer),this.refreshDelayTimer=null),y(u(n.prototype),"refresh",this).call(this),t?this.refreshDelayTimer=window.setTimeout((function(){zo(e.features,(function(e){return e.refresh()}))}),100):zo(this.features,(function(e){return e.refresh()}))}}]),n}(Hf),zd=Vv;function Ud(e,t){var n=null==e?0:e.length;return!!n&&zd(e,t,0)>-1}var Wd=Ud;function Gd(e,t,n){var r=-1,i=null==e?0:e.length;while(++r<i)if(n(t,e[r]))return!0;return!1}var Bd=Gd;function Kd(){}var Nd=Kd,Yd=yh,Xd=Nd,$d=ul,qd=1/0,Zd=Yd&&1/$d(new Yd([,-0]))[1]==qd?function(e){return new Yd(e)}:Xd,Vd=Zd,Jd=Nu,Hd=Wd,Qd=Bd,ey=qu,ty=Vd,ny=ul,ry=200;function iy(e,t,n){var r=-1,i=Hd,o=e.length,a=!0,s=[],u=s;if(n)a=!1,i=Qd;else if(o>=ry){var l=t?null:ty(e);if(l)return ny(l);a=!1,i=ey,u=new Jd}else u=t?[]:s;e:while(++r<o){var h=e[r],c=t?t(h):h;if(h=n||0!==h?h:0,a&&c===c){var v=u.length;while(v--)if(u[v]===c)continue e;t&&u.push(c),s.push(h)}else i(u,c,n)||(u!==s&&u.push(c),s.push(h))}return s}var oy=iy,ay=oy;function sy(e){return e&&e.length?ay(e):[]}var uy=sy,ly=Qt,hy=ji;function cy(e,t){return e&&ly(t,hy(t),e)}var vy=cy;function fy(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}var dy=fy,yy=Je,py=Qn,my=dy,gy=Object.prototype,by=gy.hasOwnProperty;function wy(e){if(!yy(e))return my(e);var t=py(e),n=[];for(var r in e)("constructor"!=r||!t&&by.call(e,r))&&n.push(r);return n}var xy=wy,ky=yi,Sy=xy,Py=_n;function Dy(e){return Py(e)?ky(e,!0):Sy(e)}var My=Dy,Ay=Qt,Cy=My;function Oy(e,t){return e&&Ay(t,Cy(t),e)}var Ty=Oy,jy={exports:{}};function Iy(e,t){var n=-1,r=e.length;t||(t=Array(r));while(++n<r)t[n]=e[n];return t}(function(e,t){var n=Ae,r=t&&!t.nodeType&&t,i=r&&e&&!e.nodeType&&e,o=i&&i.exports===r,a=o?n.Buffer:void 0,s=a?a.allocUnsafe:void 0;function u(e,t){if(t)return e.slice();var n=e.length,r=s?s(n):new e.constructor(n);return e.copy(r),r}e.exports=u})(jy,jy.exports);var Ly=Iy,Fy=Qt,Ey=Xl;function _y(e,t){return Fy(e,Ey(e),t)}var Ry=_y,zy=mi,Uy=zy(Object.getPrototypeOf,Object),Wy=Uy,Gy=Ll,By=Wy,Ky=Xl,Ny=Ul,Yy=Object.getOwnPropertySymbols,Xy=Yy?function(e){var t=[];while(e)Gy(t,Ky(e)),e=By(e);return t}:Ny,$y=Xy,qy=Qt,Zy=$y;function Vy(e,t){return qy(e,Zy(e),t)}var Jy=Vy,Hy=Rl,Qy=$y,ep=My;function tp(e){return Hy(e,ep,Qy)}var np=tp,rp=Object.prototype,ip=rp.hasOwnProperty;function op(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&ip.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var ap=op,sp=il;function up(e){var t=new e.constructor(e.byteLength);return new sp(t).set(new sp(e)),t}var lp=up,hp=lp;function cp(e,t){var n=t?hp(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}var vp=cp,fp=/\w*$/;function dp(e){var t=new e.constructor(e.source,fp.exec(e));return t.lastIndex=e.lastIndex,t}var yp=dp,pp=Te,mp=pp?pp.prototype:void 0,gp=mp?mp.valueOf:void 0;function bp(e){return gp?Object(gp.call(e)):{}}var wp=bp,xp=lp;function kp(e,t){var n=t?xp(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var Sp=kp,Pp=lp,Dp=vp,Mp=yp,Ap=wp,Cp=Sp,Op="[object Boolean]",Tp="[object Date]",jp="[object Map]",Ip="[object Number]",Lp="[object RegExp]",Fp="[object Set]",Ep="[object String]",_p="[object Symbol]",Rp="[object ArrayBuffer]",zp="[object DataView]",Up="[object Float32Array]",Wp="[object Float64Array]",Gp="[object Int8Array]",Bp="[object Int16Array]",Kp="[object Int32Array]",Np="[object Uint8Array]",Yp="[object Uint8ClampedArray]",Xp="[object Uint16Array]",$p="[object Uint32Array]";function qp(e,t,n){var r=e.constructor;switch(t){case Rp:return Pp(e);case Op:case Tp:return new r(+e);case zp:return Dp(e,n);case Up:case Wp:case Gp:case Bp:case Kp:case Np:case Yp:case Xp:case $p:return Cp(e,n);case jp:return new r;case Ip:case Ep:return new r(e);case Lp:return Mp(e);case Fp:return new r;case _p:return Ap(e)}}var Zp=qp,Vp=Je,Jp=Object.create,Hp=function(){function e(){}return function(t){if(!Vp(t))return{};if(Jp)return Jp(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}(),Qp=Hp,em=Qp,tm=Wy,nm=Qn;function rm(e){return"function"!=typeof e.constructor||nm(e)?{}:em(tm(e))}var im=rm,om=Uh,am=rr,sm="[object Map]";function um(e){return am(e)&&om(e)==sm}var lm=um,hm=lm,cm=Hr,vm=Qr.exports,fm=vm&&vm.isMap,dm=fm?cm(fm):hm,ym=dm,pm=Uh,mm=rr,gm="[object Set]";function bm(e){return mm(e)&&pm(e)==gm}var wm=bm,xm=wm,km=Hr,Sm=Qr.exports,Pm=Sm&&Sm.isSet,Dm=Pm?km(Pm):xm,Mm=Dm,Am=Fu,Cm=vo,Om=Zt,Tm=vy,jm=Ty,Im=jy.exports,Lm=Ly,Fm=Ry,Em=Jy,_m=Jl,Rm=np,zm=Uh,Um=ap,Wm=Zp,Gm=im,Bm=mr,Km=gr.exports,Nm=ym,Ym=Je,Xm=Mm,$m=ji,qm=My,Zm=1,Vm=2,Jm=4,Hm="[object Arguments]",Qm="[object Array]",eg="[object Boolean]",tg="[object Date]",ng="[object Error]",rg="[object Function]",ig="[object GeneratorFunction]",og="[object Map]",ag="[object Number]",sg="[object Object]",ug="[object RegExp]",lg="[object Set]",hg="[object String]",cg="[object Symbol]",vg="[object WeakMap]",fg="[object ArrayBuffer]",dg="[object DataView]",yg="[object Float32Array]",pg="[object Float64Array]",mg="[object Int8Array]",gg="[object Int16Array]",bg="[object Int32Array]",wg="[object Uint8Array]",xg="[object Uint8ClampedArray]",kg="[object Uint16Array]",Sg="[object Uint32Array]",Pg={};function Dg(e,t,n,r,i,o){var a,s=t&Zm,u=t&Vm,l=t&Jm;if(n&&(a=i?n(e,r,i,o):n(e)),void 0!==a)return a;if(!Ym(e))return e;var h=Bm(e);if(h){if(a=Um(e),!s)return Lm(e,a)}else{var c=zm(e),v=c==rg||c==ig;if(Km(e))return Im(e,s);if(c==sg||c==Hm||v&&!i){if(a=u||v?{}:Gm(e),!s)return u?Em(e,jm(a,e)):Fm(e,Tm(a,e))}else{if(!Pg[c])return i?e:{};a=Wm(e,c,s)}}o||(o=new Am);var f=o.get(e);if(f)return f;o.set(e,a),Xm(e)?e.forEach((function(r){a.add(Dg(r,t,n,r,e,o))})):Nm(e)&&e.forEach((function(r,i){a.set(i,Dg(r,t,n,i,e,o))}));var d=l?u?Rm:_m:u?qm:$m,y=h?void 0:d(e);return Cm(y||e,(function(r,i){y&&(i=r,r=e[i]),Om(a,i,Dg(r,t,n,i,e,o))})),a}Pg[Hm]=Pg[Qm]=Pg[fg]=Pg[dg]=Pg[eg]=Pg[tg]=Pg[yg]=Pg[pg]=Pg[mg]=Pg[gg]=Pg[bg]=Pg[og]=Pg[ag]=Pg[sg]=Pg[ug]=Pg[lg]=Pg[hg]=Pg[cg]=Pg[wg]=Pg[xg]=Pg[kg]=Pg[Sg]=!0,Pg[ng]=Pg[rg]=Pg[vg]=!1;var Mg=Dg,Ag=Mg,Cg=1,Og=4;function Tg(e){return Ag(e,Cg|Og)}var jg=Tg,Ig=function(){function e(t){r(this,e),a(this,"actions",[]),a(this,"map",{getScale:function(){return 1},transformGlobalToScreen:function(e){var t=e.x,n=e.y,r=this.bounds,i=r.x,o=r.y;return{x:t-i,y:o-n}}}),this.bounds=t,this.createRenderCanvas(),this.map.getScale=this.map.getScale.bind(this),this.map.transformGlobalToScreen=this.map.transformGlobalToScreen.bind(this)}return o(e,[{key:"createRenderCanvas",value:function(){var e=this.bounds,t=e.width,n=e.height;this.canvas=new OffscreenCanvas(t,n),this.canvas.width=t*Hf.dpr,this.canvas.height=n*Hf.dpr,this.canvasContext=this.canvas.getContext("2d")}},{key:"addAction",value:function(e){e.setStyle({strokeStyle:"#ff0000",fillStyle:"#ff0000"},{refresh:!1}),e.onAdd(this),this.actions.push(e)}},{key:"addActions",value:function(e){var t=this;zo(e,(function(e){return t.addAction(e)}))}},{key:"getRle",value:function(){for(var e=[],t=Hf.dpr,n=this.bounds,r=n.width,i=n.height,o=this.canvas,a=o.width,s=o.height,u=this.canvasContext.getImageData(0,0,a,s).data,l=0,h=1,c=0;c<i;c++)for(var v=0;v<r;v++){var f=4*(c*t*r+v)*t,d=u[f],y=u[f+1],p=u[f+2],m=u[f+3],g=+!!(d||y||p||m);g===h?l++:(e.push(l),l=1),c+1===i&&v+1===r&&e.push(l),h=g}return e}},{key:"refresh",value:function(){zo(this.actions,(function(e){return e.refresh()}))}},{key:"clear",value:function(){this.canvasContext.clearRect(0,0,this.canvas.width,this.canvas.height)}}]),e}(),Lg=function(e){s(n,e);var t=f(n);function n(e){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(this,n),i=t.call(this,e,ed.Mask,o,s),a(c(i),"actions",[]),i}return o(n,[{key:"addAction",value:function(e,t){e.onAdd(this),this.actions.push(e)}},{key:"removeActionById",value:function(e){var t=Av(this.actions,(function(t){var n=t.id;return n!==e||(t.onRemove(),!1)}));this.actions=t,this.refresh()}},{key:"getAllActions",value:function(){return this.actions}},{key:"removeAllActions",value:function(){var e=Av(this.actions,(function(e){return e.onRemove(),!1}));this.actions=e,this.refresh()}},{key:"setMovingClearAction",value:function(e){e&&e.onAdd(this),!e&&this.refresh()}},{key:"getActionCategories",value:function(){var e=this.actions,t=Rv(e,(function(e){var t=e.category;return t}));return Av(uy(t),(function(e){return!!e}))}},{key:"groupByCategory",value:function(){var e=this.actions,t=this.getActionCategories(),n=[];return zo(t,(function(t){var r=Av(e,(function(e){var n=e.type,r=e.category;return r===t||n===Kf.Clear}));n.push({category:t,actions:r})})),n}},{key:"getGroupRleData",value:function(e,t){var n=e.category,r=e.actions,i=void 0===r?[]:r,o=new Ig(t),a=jg(i);o.addActions(a);var s=o.getRle();return{category:n,rle:s}}},{key:"getRleData",value:function(e){var t=this,n=this.groupByCategory(),r=[];return zo(n,(function(n){var i=t.getGroupRleData(n,e);r.push(i)})),r}},{key:"refresh",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.refreshDelayTimer&&(window.clearTimeout(this.refreshDelayTimer),this.refreshDelayTimer=null),y(u(n.prototype),"refresh",this).call(this),t?this.refreshDelayTimer=window.setTimeout((function(){zo(e.actions,(function(e){return e.refresh()}))}),100):zo(this.actions,(function(e){return e.refresh()}))}}]),n}(Hf),Fg=function(e){s(n,e);var t=f(n);function n(e){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(this,n),i=t.call(this,e,ed.Text,o,s),a(c(i),"texts",[]),i}return o(n,[{key:"addText",value:function(e,t){var n=t||{},r=n.clear,i=void 0!==r&&r;i&&this.clear(),e.onAdd(this),this.texts.push(e)}},{key:"removeTextById",value:function(e){var t=Av(this.texts,(function(t){var n=t.id;return n!==e||(t.onRemove(),!1)}));this.texts=t,this.refresh()}},{key:"getTextById",value:function(e){return Ld(this.texts,(function(t){var n=t.id;return n===e}))}},{key:"getAllTexts",value:function(){return this.texts}},{key:"removeAllTexts",value:function(){var e=Av(this.texts,(function(e){return e.onRemove(),!1}));this.texts=e,this.refresh()}},{key:"refresh",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.refreshDelayTimer&&(window.clearTimeout(this.refreshDelayTimer),this.refreshDelayTimer=null),y(u(n.prototype),"refresh",this).call(this),t?this.refreshDelayTimer=window.setTimeout((function(){zo(e.texts,(function(e){return e.refresh()}))}),100):zo(this.texts,(function(e){return e.refresh()}))}}]),n}(Hf),Eg={Text:Fg,Mask:Lg,Image:_d,Feature:Rd},_g={Point:ld,Circle:dd,Line:hd,Polyline:cd,Rect:vd,Polygon:fd},Rg=function(e){s(n,e);var t=f(n);function n(e,i,o){var s,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return r(this,n),s=t.call(this,e,Kf.Image,u,l),a(c(s),"category",""),s.imageInfo=Gi({},n.defaultImageInfo,o),s.position=s.imageInfo.position,s.updateImage(),s.category=i,s}return o(n,[{key:"updateImage",value:function(){var e=this;this.imageInfo.src&&(this.image=new Image,this.image.src=this.imageInfo.src,this.image.onload=function(){return e.layer&&e.refresh()})}},{key:"drawImage",value:function(){var e=this.layer.map.transformGlobalToScreen(this.position),t=e.x,n=e.y,r=Hf.dpr,i=this.layer.map.getScale(),o=this.imageInfo,a=o.width,s=o.height,u=a*i,l=s*i;Qf.drawImage(this.layer.canvasContext,{image:this.image,x:t*r,y:n*r,width:u*r,height:l*r},{})}},{key:"refresh",value:function(){y(u(n.prototype),"refresh",this).call(this),this.drawImage()}}]),n}(Yf);a(Rg,"defaultImageInfo",{src:"",width:0,height:0,position:{x:0,y:0}});var zg,Ug={Draw:pd,Clear:rd,Image:Rg},Wg=function(){function e(t,n,i,o){r(this,e),this.id=t,this.type=n,this.props=i||{},this.option=o||{},this.domId="control-grid-".concat(t,"-wrapper"),this.createContainer()}return o(e,[{key:"createContainer",value:function(){this.dom||(this.dom=document.createElement("div"),this.dom.setAttribute("id",this.domId),this.dom.style.position="absolute",this.dom.style.left="0",this.dom.style.top="0",this.dom.style.zIndex="20")}},{key:"onAdd",value:function(e){this.map=e,this.map.dom.appendChild(this.dom)}},{key:"onRemove",value:function(){var e=document.getElementById(this.domId);e&&e.remove()}},{key:"updatePosition",value:function(e){this.position=e,this.refresh()}},{key:"refresh",value:function(){}},{key:"printInfo",value:function(){}}]),e}(),Gg=function(e){s(n,e);var t=f(n);function n(){return r(this,n),t.call(this)}return o(n,[{key:"refresh",value:function(){}}]),n}(Wg);(function(e){e["Scale"]="SCALE",e["Grid"]="GRID"})(zg||(zg={}));var Bg=function(e){s(n,e);var t=f(n);function n(e,i,o,a){var s;return r(this,n),console.log(111,e),s=t.call(this,e,zg.Grid,o,a),s.gridInfo=Gi({},n.defaultGridInfo,i),s.creatCanvasElement(),s.refreshElement(),s}return o(n,[{key:"refreshElement",value:function(){this.setContainerSize(),this.setContainerPosition(),this.setContainerStyle(),this.setRenderCanvasSize()}},{key:"setContainerSize",value:function(){var e=this.gridInfo.size,t=e.width,n=e.height;this.dom.style.width=t+"px",this.dom.style.height=n+"px"}},{key:"setContainerPosition",value:function(){var e=this.gridInfo.position,t=e.left,n=e.top,r=e.right,i=e.bottom;this.dom.style.left=au(t)?"".concat(t,"px"):"initial",this.dom.style.right=au(r)?"".concat(r,"px"):"initial",this.dom.style.top=au(n)?"".concat(n,"px"):"initial",this.dom.style.bottom=au(i)?"".concat(i,"px"):"initial"}},{key:"setContainerStyle",value:function(){this.dom.style.border="1px solid red"}},{key:"creatCanvasElement",value:function(){this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.left="0",this.canvas.style.top="0",this.dom.appendChild(this.canvas),this.canvasContext=this.canvas.getContext("2d")}},{key:"setRenderCanvasSize",value:function(){var e=this.gridInfo.size,t=e.width,n=e.height;this.canvas.width=t*Hf.dpr,this.canvas.height=n*Hf.dpr,this.canvas.style.width=t+"px",this.canvas.style.height=n+"px"}},{key:"refresh",value:function(){}}]),n}(Wg);a(Bg,"defaultGridInfo",{position:{right:10,bottom:10},size:{width:200,height:200},grid:{columns:[],rows:[]}});var Kg={Scale:Gg,Grid:Bg},Ng=function(){function e(t,n){var i=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r(this,e),a(this,"dragging",!1),a(this,"draggingEnabled",!1),a(this,"events",{on:function(e,t){i.eventsObServer.on(e,t)}}),this.id=t,this.type=id.Marker,this.props=o,this.markerInfo=Gi({},e.defaultMarkerInfo,n),this.updateImage(),this.eventsObServer=new N.EventEmitter}return o(e,[{key:"onAdd",value:function(e){this.layer=e,this.refresh()}},{key:"onRemove",value:function(){var e=document.getElementById(this.id);e&&e.remove()}},{key:"enableDragging",value:function(){this.draggingEnabled=!0,this.dragging=!1}},{key:"disableDragging",value:function(){this.draggingEnabled=!1,this.dragging=!1}},{key:"updateImage",value:function(){var e=this;this.markerInfo.src&&(this.image=new Image,this.image.id=this.id,this.image.setAttribute("data-type",this.type),this.image.style.position="absolute",this.image.style.cursor="pointer",this.image.style.userSelect="none",this.image.src=this.markerInfo.src,this.image.onload=function(){var t,n;null===(t=e.layer)||void 0===t||null===(n=t.dom)||void 0===n||n.appendChild(e.image),e.attachEvents()},this.image.onerror=function(){console.error("marker‘s src onerror")})}},{key:"updatePosition",value:function(e){var t=this.markerInfo;this.markerInfo=n(n({},t),{},{position:e}),this.refresh()}},{key:"handleMouseDown",value:function(e){var t=this,n=e.screenX,r=e.screenY;this.startPageScreenPoint={x:n,y:r},this.toUpdatePosition=null;var i=ad.EventUtil.getButtonIndex(e);this.eventsObServer.emit(od.MouseDown,this),2===i&&this.eventsObServer.emit(od.RightClick,this),this.draggingEnabled&&(this.dragging=!0,document.onmousemove=function(e){return t.handleMarkerMove(e)},document.onmouseup=function(e){return t.handleMarkerUp(e)},this.eventsObServer.emit(od.DragStart,this))}},{key:"handleMarkerMove",value:function(e){var t=this.layer.map.getScale(),n=e.screenX,r=e.screenY,i=this.startPageScreenPoint,o=i.x,a=i.y,s=n-o,u=r-a,l=s/t,h=u/t,c=this.layer.map.xAxis.direction===wv.Right,v=this.layer.map.yAxis.direction===xv.Top,f=c?l:-l,d=v?h:-h,y=this.markerInfo.position;this.toUpdatePosition={x:y.x+f,y:y.y-d},this.refresh(this.toUpdatePosition),this.eventsObServer.emit(od.Dragging,this,this.toUpdatePosition)}},{key:"handleMarkerUp",value:function(e){this.dragging=!1,document.onmousemove=null,document.onmouseup=null,this.toUpdatePosition&&(this.refresh(),this.eventsObServer.emit(od.DragEnd,this,this.toUpdatePosition)),this.toUpdatePosition=null}},{key:"handleMouseUp",value:function(e){this.eventsObServer.emit(od.MouseUp,this)}},{key:"handleMouseOver",value:function(e){this.eventsObServer.emit(od.MouseOver,this)}},{key:"handleMouseOut",value:function(e){this.eventsObServer.emit(od.MouseOut,this)}},{key:"handleClick",value:function(e){this.eventsObServer.emit(od.Click,this)}},{key:"attachEvents",value:function(){var e=this;this.image.onmousedown=function(t){return e.handleMouseDown(t)},this.image.onmouseup=function(t){return e.handleMouseUp(t)},this.image.onmouseover=function(t){return e.handleMouseOver(t)},this.image.onmouseout=function(t){return e.handleMouseOut(t)},this.image.onclick=function(t){return e.handleClick(t)}}},{key:"refresh",value:function(e){var t=this.markerInfo,n=t.position,r=t.offset,i=e||n,o=this.layer.map.transformGlobalToScreen(i),a=o.x,s=o.y,u=r.x,l=r.y,h=a+u,c=s-l;this.image.style.left="".concat(h,"px"),this.image.style.top="".concat(c,"px")}},{key:"printInfo",value:function(){}}]),e}();a(Ng,"defaultMarkerInfo",{src:"",position:{x:0,y:0},offset:{x:0,y:0}});var Yg={Map:Ed,Layer:Eg,Feature:_g,Mask:Ug,Control:Kg,Text:md,Marker:Ng,Util:ad,version:"5.0.20"};return Yg}))}).call(this,n("c8ba"))},a434:function(e,t,n){"use strict";var r=n("23e7"),i=n("23cb"),o=n("a691"),a=n("50c4"),s=n("7b0b"),u=n("65f0"),l=n("8418"),h=n("1dde"),c=h("splice"),v=Math.max,f=Math.min,d=9007199254740991,y="Maximum allowed length exceeded";r({target:"Array",proto:!0,forced:!c},{splice:function(e,t){var n,r,h,c,p,m,g=s(this),b=a(g.length),w=i(e,b),x=arguments.length;if(0===x?n=r=0:1===x?(n=0,r=b-w):(n=x-2,r=f(v(o(t),0),b-w)),b+n-r>d)throw TypeError(y);for(h=u(g,r),c=0;c<r;c++)p=w+c,p in g&&l(h,c,g[p]);if(h.length=r,n<r){for(c=w;c<b-r;c++)p=c+r,m=c+n,p in g?g[m]=g[p]:delete g[m];for(c=b;c>b-r+n;c--)delete g[c-1]}else if(n>r)for(c=b-r;c>w;c--)p=c+r-1,m=c+n-1,p in g?g[m]=g[p]:delete g[m];for(c=0;c<n;c++)g[c+w]=arguments[c+2];return g.length=b-r+n,h}})},c740:function(e,t,n){"use strict";var r=n("23e7"),i=n("b727").findIndex,o=n("44d2"),a="findIndex",s=!0;a in[]&&Array(1)[a]((function(){s=!1})),r({target:"Array",proto:!0,forced:s},{findIndex:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),o(a)},de3d:function(e,t,n){"use strict";(function(t){var n,r,i=t.MutationObserver||t.WebKitMutationObserver;if(i){var o=0,a=new i(h),s=t.document.createTextNode("");a.observe(s,{characterData:!0}),n=function(){s.data=o=++o%2}}else if(t.setImmediate||"undefined"===typeof t.MessageChannel)n="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){h(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(h,0)};else{var u=new t.MessageChannel;u.port1.onmessage=h,n=function(){u.port2.postMessage(0)}}var l=[];function h(){var e,t;r=!0;var n=l.length;while(n){t=l,l=[],e=-1;while(++e<n)t[e]();n=l.length}r=!1}function c(e){1!==l.push(e)||r||n()}e.exports=c}).call(this,n("c8ba"))}}]);